"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5139],{871:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});var r=a(6540);function n(){const e=(0,r.useRef)(null),{0:t,1:a}=(0,r.useState)(!1),{0:n,1:o}=(0,r.useState)(!1),{0:l,1:i}=(0,r.useState)(null),{0:d,1:s}=(0,r.useState)(null),{0:c,1:u}=(0,r.useState)(""),{0:p,1:g}=(0,r.useState)(null),{0:m,1:f}=(0,r.useState)(null),{0:h,1:v}=(0,r.useState)(!1),y="https://curly-pond-edc4.snowy-frost-b196.workers.dev/api/upload-image",b=e=>{u(t=>t?t+"\n"+e:e)},w=async e=>{try{return(await fetch(e,{method:"HEAD"})).ok}catch(t){return!1}},E=e=>{if(!e)return;if(!e.type.startsWith("image/"))return void b("‚ùå Not an image: "+(e.type||"unknown"));i(e),g(null),u(""),f(null),v(!1);const t=URL.createObjectURL(e);s(t),b("üì¶ Selected: "+e.name+" ("+Math.round(e.size/1024)+" KB)")},S=async e=>{o(!0),g(null),f(null),v(!1);try{var t,a,r,n,l;b("‚è≥ Uploading...");const o=new FormData;o.append("file",e);const d=await fetch(y,{method:"POST",body:o}),s=await d.text();let c=null;try{c=JSON.parse(s)}catch(i){}if(!d.ok)return b("‚ùå Upload failed (HTTP "+d.status+")"),void b(s);if(b("‚úÖ Upload success!"),g(c),null!==(t=c)&&void 0!==t&&t.pagesUrl&&b("üåç pagesUrl: "+c.pagesUrl),null!==(a=c)&&void 0!==a&&a.downloadUrl&&b("‚¨áÔ∏è downloadUrl: "+c.downloadUrl),null!==(r=c)&&void 0!==r&&r.path&&b("üìÅ path: "+c.path),null!==(n=c)&&void 0!==n&&n.sha&&b("üîë sha: "+c.sha),null!==(l=c)&&void 0!==l&&l.path){const e=(e=>{const t=e.split("/").pop()||"",a=t.lastIndexOf(".");return"https://mtcmarketing.github.io/images--tinh-hoa-viet/images/"+(a>=0?t.slice(0,a):t)+".webp?v="+Date.now()})(c.path);f(e),b("üß† Expected WEBP: "+e),await(async e=>{v(!1),b("üïµÔ∏è Waiting for WEBP output...");for(let t=1;t<=30;t++){if(await w(e))return b("‚úÖ WEBP ready! ("+t+"/30)"),void v(!0);b("‚è≥ Not ready yet... ("+t+"/30)"),await new Promise(e=>setTimeout(e,2e3))}b("‚ùå WEBP not found after waiting. Action may still be running.")})(e)}}catch(d){b("‚ùå Upload error: "+((null==d?void 0:d.message)||String(d)))}finally{o(!1)}};return r.createElement("div",{style:{width:"100%",height:"100vh",backgroundColor:"white",display:"flex",justifyContent:"center",alignItems:"center",padding:20,boxSizing:"border-box",fontFamily:"system-ui, Arial"}},r.createElement("div",{style:{width:"min(720px, 100%)",border:"1px solid #ddd",borderRadius:12,padding:18,boxShadow:"0 10px 30px rgba(0,0,0,0.06)"}},r.createElement("h2",{style:{margin:0,marginBottom:6}},"Upload Image"),r.createElement("div",{style:{fontSize:13,color:"#555",marginBottom:14}},"Drag & drop an image, or click to upload. It will POST to your Worker, then wait for GitHub Actions to generate the WEBP."),r.createElement("div",{onClick:()=>{var t;null===(t=e.current)||void 0===t||t.click()},onDrop:async e=>{var t;e.preventDefault(),e.stopPropagation(),a(!1);const r=null===(t=e.dataTransfer.files)||void 0===t?void 0:t[0];r&&(E(r),await S(r))},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),a(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),a(!1)},style:{cursor:"pointer",userSelect:"none",border:"2px dashed "+(t?"#000":"#bbb"),borderRadius:12,padding:18,textAlign:"center",background:t?"rgba(0,0,0,0.03)":"#fafafa"}},r.createElement("input",{ref:e,type:"file",accept:"image/*",style:{display:"none"},onChange:async e=>{var t;const a=(null===(t=e.target.files)||void 0===t?void 0:t[0])||null;a&&(E(a),await S(a))}}),r.createElement("div",{style:{fontSize:14,fontWeight:600}},n?"Uploading...":"Drop image here or click to upload"),r.createElement("div",{style:{fontSize:12,color:"#666",marginTop:6}},"Endpoint: ",r.createElement("code",null,y)),l&&r.createElement("div",{style:{marginTop:10,fontSize:12,color:"#444"}},"Selected: ",r.createElement("b",null,l.name))),d&&r.createElement("div",{style:{marginTop:14}},r.createElement("div",{style:{fontSize:13,marginBottom:8,color:"#333"}},"Original Preview"),r.createElement("img",{src:d,alt:"preview",style:{width:"100%",maxHeight:260,objectFit:"contain",borderRadius:10,border:"1px solid #eee",background:"white"}})),m&&r.createElement("div",{style:{marginTop:14}},r.createElement("div",{style:{fontSize:13,marginBottom:8,color:"#333"}},"WEBP Output ",h?"‚úÖ":"‚è≥"),h?r.createElement(r.Fragment,null,r.createElement("img",{src:m,alt:"webp preview",style:{width:"100%",maxHeight:260,objectFit:"contain",borderRadius:10,border:"1px solid #eee",background:"white"}}),r.createElement("div",{style:{marginTop:8,fontSize:13}},"WEBP URL:"," ",r.createElement("a",{href:m,target:"_blank",rel:"noreferrer"},m))):r.createElement("div",{style:{fontSize:12,color:"#666"}},"Waiting for GitHub Actions to finish processing...")),r.createElement("div",{style:{marginTop:14}},r.createElement("div",{style:{fontSize:13,marginBottom:6,color:"#333"}},"Console"),r.createElement("pre",{style:{background:"#0b0b0d",color:"#d9d9d9",padding:12,borderRadius:10,fontSize:12,minHeight:120,overflow:"auto",whiteSpace:"pre-wrap",lineHeight:1.35}},c||"Drop an image to start...")),(null==p?void 0:p.downloadUrl)&&r.createElement("div",{style:{marginTop:10,fontSize:13}},"Original downloadUrl:"," ",r.createElement("a",{href:p.downloadUrl,target:"_blank",rel:"noreferrer"},p.downloadUrl)),(null==p?void 0:p.pagesUrl)&&r.createElement("div",{style:{marginTop:6,fontSize:13}},"Original pagesUrl:"," ",r.createElement("a",{href:p.pagesUrl,target:"_blank",rel:"noreferrer"},p.pagesUrl))))}}}]);
//# sourceMappingURL=component---src-pages-test-upload-image-tsx-338292516b9eea76a692.js.map