{"version":3,"file":"component---src-pages-test-role-v-2-tsx-6cb9b7d7c4aaad05a260.js","mappings":"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","sources":["webpack:///./src/pages/test/role-v2.tsx"],"sourcesContent":["// src/pages/test-role.tsx\nimport * as React from \"react\";\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"../../database/supabaseClient\";\n\nconst OWNER_IDS = {\n  user1: \"02c567a2-b193-4009-89e5-884386540733\",\n  admin: \"6c77d859-1af1-418e-b0e0-0d3cc4e80fad\",\n  slapkommerce: \"d3ca3641-e106-4a4d-a288-bb3e0c4e3a9a\",\n};\n\nconst TestRolePage: React.FC = () => {\n  const [uid, setUid] = useState<string | null>(null);\n  const [email, setEmail] = useState<string | null>(null);\n  const [role, setRole] = useState<string | null>(null);\n  const [results, setResults] = useState<Record<string, any[]>>({});\n  const [summaries, setSummaries] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const runTests = async () => {\n      try {\n        setLoading(true);\n\n        const { data: sessionData, error: sessionErr } = await supabase.auth.getSession();\n        if (sessionErr) throw sessionErr;\n\n        const user = sessionData?.session?.user;\n        if (!user) throw new Error(\"No logged-in user found\");\n\n        setUid(user.id);\n        setEmail(user.email || null);\n\n        const { data: roleData, error: roleErr } = await supabase\n          .from(\"user_roles\")\n          .select(\"role\")\n          .eq(\"id\", user.id)\n          .maybeSingle();\n        if (roleErr) throw roleErr;\n\n        const userRole = roleData?.role || \"none\";\n        setRole(userRole);\n\n        const newResults: Record<string, any[]> = {};\n        const newSummaries: Record<string, string> = {};\n\n        const selects = [\n          [\"(1) From user1@test.com\", { owner_id: OWNER_IDS.user1 }],\n          [\"(2) From admin@test.com\", { owner_id: OWNER_IDS.admin }],\n          [\"(3) From slapkommerce@gmail.com\", { owner_id: OWNER_IDS.slapkommerce }],\n          [\"(4) All member-role rows\", { role: \"member\" }],\n          [\"(5) All admin-role rows\", { role: \"admin\" }],\n          [\"(6) Select all rows\", {}],\n        ];\n\n        for (const [label, filter] of selects) {\n          let query = supabase.from(\"user_member_v2\").select(\"*\");\n           \n          for (const [key, value] of Object.entries(filter)) query = query.eq(key, value);\n          const { data } = await query;\n           console.log(data)\n        \n          newResults[label as any] = data || [];\n          newSummaries[label as any] = data?.length\n            ? `‚úÖ ${data.length} rows visible`\n            : \"‚ö†Ô∏è No rows (RLS restricted)\";\n        }\n\n        // WRITE TESTS\n        for (const [label, rows] of Object.entries(newResults)) {\n          if (!rows || rows.length === 0) continue;\n\n          const updated: any[] = [];\n          let successCount = 0;\n          let errorCount = 0;\n          let wrongSuccess = false;\n\n          for (const row of rows) {\n            const now = new Date();\n            const hh = String(now.getHours()).padStart(2, \"0\");\n            const mm = String(now.getMinutes()).padStart(2, \"0\");\n            const ss = String(now.getSeconds()).padStart(2, \"0\");\n            const timestamp = `${hh}:${mm}:${ss}`;\n\n            const baseName = typeof row.full_name === \"string\" ? row.full_name : \"\";\n            const cleaned = baseName.replace(/\\s?\\d{2}:\\d{2}:\\d{2}$/, \"\").trim();\n            const newValue = `${cleaned} ${timestamp}`;\n\n            const { data: upd, error: updErr } = await supabase\n              .from(\"test_table\")\n              .update({ full_name: newValue })\n              .eq(\"id\", row.id)\n              .select();\n\n            if (updErr) {\n              updated.push({ id: row.id, error: updErr.message });\n              errorCount++;\n            } else {\n              updated.push({ id: row.id, updated_to: newValue });\n              successCount++;\n              if (userRole === \"member\" && row.owner_id !== user.id) wrongSuccess = true;\n            }\n          }\n\n          let status = \"\";\n          if (userRole === \"admin\") {\n            status = `‚úÖ ${successCount} success (should succeed for admin)`;\n          } else if (userRole === \"member\") {\n            if (wrongSuccess)\n              status = `‚ùå ${successCount} success (should have failed for non-owned rows)`;\n            else if (successCount > 0)\n              status = `‚úÖ ${successCount} success (should succeed only on own rows)`;\n            else status = `‚ö†Ô∏è ${errorCount} failed (expected for restricted rows)`;\n          } else {\n            status = errorCount\n              ? `‚úÖ ${errorCount} failed (unauthenticated expected)`\n              : `‚ùå ${successCount} success (should have failed)`;\n          }\n\n          newResults[`WRITE TEST for ${label}`] = updated;\n          newSummaries[`WRITE TEST for ${label}`] = status;\n        }\n\n        setResults(newResults);\n        setSummaries(newSummaries);\n      } catch (err: any) {\n        console.error(err);\n        setError(err.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    runTests();\n  }, []);\n\n  return (\n    <div style={{ width: \"100%\", minHeight: \"100vh\", background: \"#fff\" }}>\n      <main style={{ fontFamily: \"sans-serif\", padding: \"2rem\" }}>\n        <h1>üß© Supabase Role Access + Write Timestamp Test (test_table)</h1>\n\n        {loading ? (\n          <p>Loading...</p>\n        ) : error ? (\n          <p style={{ color: \"red\" }}>Error: {error}</p>\n        ) : (\n          <>\n            <p><strong>Logged in as:</strong> {email}</p>\n            <p><strong>UID:</strong> {uid}</p>\n            <p><strong>Role (via user_roles):</strong> {role}</p>\n            <hr />\n\n            {Object.entries(results).map(([label, rows]) => (\n              <section key={label} style={{ marginBottom: \"2rem\" }}>\n                <h3>{label}</h3>\n                <p\n                  style={{\n                    fontWeight: \"bold\",\n                    color:\n                      summaries[label]?.includes(\"‚ùå\") ? \"red\" :\n                      summaries[label]?.includes(\"‚ö†Ô∏è\") ? \"orange\" :\n                      \"green\",\n                  }}\n                >\n                  {summaries[label]}\n                </p>\n                {rows.length === 0 ? (\n                  <p style={{ color: \"#999\" }}>No rows visible (RLS restricted)</p>\n                ) : (\n                  <pre\n                    style={{\n                      background: \"#f8f8f8\",\n                      padding: \"1rem\",\n                      borderRadius: \"8px\",\n                      overflowX: \"auto\",\n                    }}\n                  >\n                    {JSON.stringify(rows, null, 2)}\n                  </pre>\n                )}\n              </section>\n            ))}\n          </>\n        )}\n      </main>\n    </div>\n  );\n};\n\nexport default TestRolePage;\n"],"names":["OWNER_IDS","TestRolePage","uid","setUid","useState","email","setEmail","role","setRole","results","setResults","summaries","setSummaries","loading","setLoading","error","setError","useEffect","async","data","sessionData","sessionErr","supabase","auth","getSession","user","session","_sessionData$session","Error","id","roleData","roleErr","from","select","eq","maybeSingle","userRole","newResults","newSummaries","selects","owner_id","label","filter","query","key","value","Object","entries","console","log","length","rows","updated","successCount","errorCount","wrongSuccess","row","now","Date","hh","String","getHours","padStart","mm","getMinutes","timestamp","getSeconds","baseName","full_name","newValue","replace","trim","upd","updErr","update","push","message","updated_to","status","err","runTests","React","style","width","minHeight","background","fontFamily","padding","color","map","_ref","marginBottom","fontWeight","_summaries$label","includes","_summaries$label2","borderRadius","overflowX","JSON","stringify"],"sourceRoot":""}