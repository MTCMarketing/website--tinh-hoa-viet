"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4012],{856:function(e,t,a){var n=a(6540),s=a(4794),l=a(6898);const i={EN:{brandTitle:"TINH HOA VI·ªÜT",tagline:"Where Vietnamese Excellence Meets Global Recognition",loading:"Checking authentication...",redirect:"Redirecting..."},VN:{brandTitle:"TINH HOA VI·ªÜT",tagline:"N∆°i t√¥n vinh tinh hoa Vi·ªát Nam v∆∞∆°n t·∫ßm qu·ªëc t·∫ø",loading:"ƒêang ki·ªÉm tra x√°c th·ª±c...",redirect:"ƒêang chuy·ªÉn h∆∞·ªõng..."}};t.A=e=>{let{children:t,redirectTo:a="/members/login",language:r="EN"}=e;const{0:c,1:m}=(0,n.useState)(null),{0:d,1:o}=(0,n.useState)(i[r].loading),{0:u,1:g}=(0,n.useState)(!0),N=i[r];return(0,n.useEffect)(()=>{(async()=>{const{data:e,error:t}=await l.ND.auth.getSession();if(t)return console.error("Session error:",t),o("‚ö†Ô∏è Error checking session."),void g(!1);e.session?(m(e.session),o("‚úÖ Access granted!")):(o("‚ùå You must be logged in to view this page."),setTimeout(()=>(0,s.navigate)(a),1800)),g(!1)})();const{data:e}=l.ND.auth.onAuthStateChange((e,t)=>{m(t),t||(o(N.redirect),setTimeout(()=>(0,s.navigate)(a),1500))});return()=>{e.subscription.unsubscribe()}},[a,N.redirect]),u||!c?n.createElement("div",{className:"auth-shell"},n.createElement("aside",{className:"brand-side","aria-hidden":!0},n.createElement("div",{className:"brand-sheen"}),n.createElement("div",{className:"brand-pattern"}),n.createElement("div",{className:"brand-wrap"},n.createElement("h1",{className:"brand-name"},N.brandTitle),n.createElement("p",{className:"brand-tag"},N.tagline))),n.createElement("main",{className:"form-side"},n.createElement("div",{className:"loading-block"},n.createElement("div",{className:"spinner"}),n.createElement("p",{className:"loading-text"},d)))):n.createElement(n.Fragment,null,t)}},9524:function(e,t,a){a.r(t);var n=a(4506),s=a(6540),l=a(3),i=a(6462),r=a(6898),c=a(856);const m=e=>{let{children:t}=e;return s.createElement(s.Fragment,null)},d={EN:{brandTitle:"TINH HOA VI·ªÜT",tagline:"Where Vietnamese Excellence Meets Global Recognition",features:["Exclusive Gala Event","Cultural Performances","Networking with Honorees"],title:"Event Admission",subtitle:"Validate and admit a ticket for entry",admitBtn:"Admit User",loading:"Processing...",success:"Admission Successful!",langEN:"EN",langVN:"VN"},VN:{brandTitle:"TINH HOA VI·ªÜT",tagline:"N∆°i t√¥n vinh tinh hoa Vi·ªát Nam v∆∞∆°n t·∫ßm qu·ªëc t·∫ø",features:["S·ª± ki·ªán Gala ƒë·ªôc quy·ªÅn","Bi·ªÉu di·ªÖn vƒÉn h√≥a","K·∫øt n·ªëi c√πng c√°c tinh hoa"],title:"X√°c Nh·∫≠n V√© S·ª± Ki·ªán",subtitle:"Ki·ªÉm tra v√† x√°c nh·∫≠n v√© h·ª£p l·ªá ƒë·ªÉ v√†o c·ª≠a",admitBtn:"X√°c nh·∫≠n v√†o c·ª≠a",loading:"ƒêang x·ª≠ l√Ω...",success:"X√°c nh·∫≠n th√†nh c√¥ng!",langEN:"EN",langVN:"VN"}};t.default=()=>{const e=(0,i.useLocation)(),{0:t,1:a}=(0,s.useState)("EN"),o=d[t],{eventId:u,ticketId:g}=(0,s.useMemo)(()=>{const t=((null==e?void 0:e.pathname)||"").replace(/\/+$/,"").split("/");return{eventId:t[2],ticketId:t[4]}},[null==e?void 0:e.pathname]),{0:N,1:E}=(0,s.useState)(null),{0:h,1:v}=(0,s.useState)("scanner"),{0:p,1:b}=(0,s.useState)(!1),{0:f,1:k}=(0,s.useState)([]),y=e=>{console.log(e),k(t=>[].concat((0,n.A)(t),["["+(new Date).toLocaleTimeString()+"] "+e]))};(0,s.useEffect)(()=>{(async()=>{if(!u||!g)return void y("‚è≥ Waiting for URL parameters...");b(!0),y("üì° Fetching ticket: event_id='"+u+"', user_id='"+g+"'");const{data:e,error:t}=await r.ND.from("events").select("*").eq("event_id",u).eq("user_id",g).maybeSingle();t?(y("üí• Supabase error: "+t.message),v("fail")):e?(y("‚úÖ Ticket loaded: "+JSON.stringify(e,null,2)),E(e),v(e.is_used?"used":"valid")):(y("üö´ No matching record found."),v("fail")),b(!1)})()},[u,g]);const T=async()=>{if(!N)return void y("‚ùå No ticket loaded to admit");b(!0);const e=(new Date).toISOString();y("üïì Attempting update with used='"+e+"'");const t={used:e},{data:a,error:n}=await r.ND.from("events").update(t).eq("user_id",N.user_id).eq("event_id",N.event_id).select().maybeSingle();n?(y("üí• Update failed: "+n.message),alert("Update failed: "+n.message)):a?(y("‚úÖ Ticket admitted successfully"),E(a),v("success")):(y("‚ö†Ô∏è No data returned (possible RLS issue)"),alert("No data returned ‚Äî may be blocked by RLS")),b(!1)};return s.createElement(c.A,null,s.createElement("div",{className:"auth-shell"},s.createElement("aside",{className:"brand-side"},s.createElement("div",{className:"brand-sheen"}),s.createElement("div",{className:"brand-pattern"}),s.createElement("div",{className:"brand-wrap"},s.createElement("h1",{className:"brand-name"},o.brandTitle),s.createElement("p",{className:"brand-tag"},o.tagline),s.createElement("ul",{className:"brand-features"},o.features.map((e,t)=>s.createElement("li",{key:t,className:"feature"},s.createElement("span",{className:"tick"},"‚úì"),s.createElement("span",null,e)))))),s.createElement("main",{className:"form-side"},s.createElement("header",{className:"form-top"},s.createElement("div",{className:"lang-switch"},s.createElement("button",{className:"lang "+("EN"===t?"active":""),onClick:()=>a("EN")},o.langEN),s.createElement("span",{className:"mid"},"|"),s.createElement("button",{className:"lang "+("VN"===t?"active":""),onClick:()=>a("VN")},o.langVN))),s.createElement("section",{className:"form-wrap",style:{color:"var(--ink)"}},s.createElement("div",{className:"intro"},s.createElement("h2",{className:"title"},o.title),s.createElement("p",{className:"subtitle"},o.subtitle)),s.createElement("div",{className:"auth-form",style:{textAlign:"center",color:"var(--ink)",minHeight:300,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:12}},(()=>{switch(h){case"scanner":return s.createElement(s.Fragment,null,s.createElement("div",{className:"spinner"}),s.createElement("h3",{className:"admission-state-title"},"Waiting for QR Code‚Ä¶"),s.createElement("p",{className:"admission-desc"},"Point the scanner at a ticket QR."));case"fail":return s.createElement(s.Fragment,null,s.createElement("div",{className:"admission-emoji"},"‚ùå"),s.createElement("h3",{className:"admission-state-title"},"Ticket Not Found"),s.createElement("p",{className:"admission-desc"},"This QR code does not match any ticket."));case"used":return s.createElement(s.Fragment,null,s.createElement("div",{className:"admission-emoji"},"‚ö†Ô∏è"),s.createElement("h3",{className:"admission-state-title"},"Already Used"),s.createElement("p",{className:"admission-desc"},"This ticket has already been admitted."));case"valid":return s.createElement(s.Fragment,null,s.createElement("div",{className:"admission-emoji"},"‚úÖ"),s.createElement("h3",{className:"admission-state-title"},"Valid Ticket"),s.createElement("p",{className:"admission-desc"},"Ticket is valid and unused."),s.createElement("button",{className:"cta",onClick:T,disabled:p,style:{marginTop:10}},p?o.loading:o.admitBtn,!p&&s.createElement(l.dyV,{className:"arrow"})));case"success":return s.createElement(s.Fragment,null,s.createElement("div",{className:"admission-emoji"},"üéâ"),s.createElement("h3",{className:"admission-state-title"},o.success),s.createElement("p",{className:"admission-desc"},"Welcome to the event!"),s.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:6,color:"var(--gold-2)"}},s.createElement(l.A3x,{size:22}),s.createElement("span",null,"Admission Complete")))}})()),s.createElement(m,null,s.createElement("div",{style:{background:"#000",color:"#0f0",padding:10,marginTop:20,borderRadius:6,fontSize:11,textAlign:"left",maxHeight:200,overflowY:"auto"}},s.createElement("strong",null,"üß† Debug Log:"),s.createElement("pre",null,f.join("\n")))))),s.createElement("style",null,"\n          @keyframes spin { to { transform: rotate(360deg); } }\n          .spinner {\n            width: 28px; height: 28px;\n            border: 3px solid var(--gold-2);\n            border-top-color: transparent;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin: 0 auto 10px;\n          }\n        ")))}}}]);
//# sourceMappingURL=component---src-pages-event-[event-id]-admissions-[ticket-id]-tsx-f5d986d59324f905d18f.js.map