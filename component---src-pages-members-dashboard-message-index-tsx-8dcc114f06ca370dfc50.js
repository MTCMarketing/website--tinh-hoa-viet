"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3910],{655:function(e,t,r){var n=r(6955),o=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return o(e)}},1713:function(e,t,r){r.r(t),r.d(t,{default:function(){return l}});var n=r(6540),o=(r(6910),r(5458)),i=r(3),a=r(6898);const s=()=>{const{0:e,1:t}=(0,n.useState)(""),{0:r,1:s}=(0,n.useState)([]),{0:l,1:c}=(0,n.useState)([]),{0:u,1:d}=(0,n.useState)(!1),{0:f,1:p}=(0,n.useState)(null),g=(0,n.useRef)(null),v=(0,n.useRef)(null),m="6c77d859-1af1-418e-b0e0-0d3cc4e80fad";(0,n.useEffect)(()=>{a.ND.auth.getSession().then(e=>{var t,r,n;let{data:o}=e;const i=null!==(t=null===(r=o.session)||void 0===r||null===(n=r.user)||void 0===n?void 0:n.id)&&void 0!==t?t:null;console.log("ðŸ‘¤ User ID:",i),p(i)})},[]),(0,n.useEffect)(()=>{(async()=>{if(!f)return;console.log("ðŸ“¦ Fetching messages for:",f);const{data:e,error:t}=await a.ND.from("dm_messages").select("*").or("sender_id.eq."+f+",recipient_id.eq."+f).order("created_at",{ascending:!0});t?console.error("âŒ Fetch failed:",t.message):(console.log("âœ… Loaded "+e.length+" messages"),s(e))})()},[f]),(0,n.useEffect)(()=>{if(!f)return;console.log("ðŸ‘‚ Listening for realtime messages involving:",f);const e=a.ND.channel("dm_stream_user_"+f).on("postgres_changes",{event:"INSERT",schema:"public",table:"dm_messages"},e=>{const t=e.new;t.sender_id!==f&&t.recipient_id!==f||(s(e=>{if(e.some(e=>e.id===t.id))return e;return[].concat((0,o.A)(e),[t]).sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())}),setTimeout(()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},0))}).subscribe(e=>console.log("ðŸ“¡ Channel status:",e));return()=>{console.log("ðŸ§¹ Unsubscribing..."),a.ND.removeChannel(e)}},[f]),(0,n.useEffect)(()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[r]);const h=async()=>{if(e.trim()&&f){d(!0);try{var r;const{data:n}=await a.ND.auth.getSession(),i=null==n||null===(r=n.session)||void 0===r?void 0:r.user;if(!i)throw new Error("Not logged in");console.log("ðŸ§¾ Insert payload:",{sender_id:i.id,message:e,recipient_id:m});const{data:l,error:u}=await a.ND.from("dm_messages").insert([{sender_id:i.id,message:e,recipient_id:m}]).select();u&&console.error("ðŸ”¥ Supabase insert error:",u),l&&l[0]&&(s(e=>[].concat((0,o.A)(e),[l[0]])),t(""),c([]),setTimeout(()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},0))}catch(n){console.error("âŒ Send failed:",n.message)}finally{d(!1)}}};return n.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"#f9fafb",color:"#111827"}},n.createElement("div",{style:{background:"#e2e8f0",color:"#1e293b",fontSize:"12px",padding:"6px 12px",borderBottom:"1px solid #cbd5e1"}},"ðŸ‘¤ ",n.createElement("strong",null,"Current User ID:")," ",null!=f?f:"Loadingâ€¦ (no session yet)"),n.createElement("div",{style:{flexGrow:1,overflowY:"auto",padding:"20px",paddingBottom:"100px"}},r.map(e=>{const t=e.sender_id===f;return n.createElement("div",{key:e.id,style:{display:"flex",justifyContent:t?"flex-end":"flex-start",marginBottom:"10px"}},n.createElement("div",{style:{background:t?"#00838F":"#E2E8F0",color:t?"white":"#1E293B",borderRadius:"12px",padding:"10px 14px",maxWidth:"70%",wordBreak:"break-word"}},n.createElement("div",{style:{fontSize:"14px"}},e.message),n.createElement("div",{style:{fontSize:"11px",marginTop:"4px",opacity:.6,textAlign:t?"right":"left"}},new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))))}),n.createElement("div",{ref:v})),n.createElement("div",{style:{position:"sticky",bottom:0,background:"#fff",borderTop:"1px solid #e5e7eb",padding:"12px 20px",display:"flex",alignItems:"center",gap:"10px"}},n.createElement("button",{onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.click()},style:{background:"none",border:"none",color:"#0369a1",cursor:"pointer"}},n.createElement(i._mV,{size:18})),n.createElement("input",{type:"file",ref:g,multiple:!0,onChange:e=>{if(e.target.files){const t=Array.from(e.target.files);c(e=>[].concat((0,o.A)(e),t))}},style:{display:"none"}}),n.createElement("input",{value:e,onChange:e=>t(e.target.value),placeholder:"Type your message...",style:{flexGrow:1,borderRadius:"8px",border:"1px solid #d1d5db",padding:"10px",fontSize:"14px"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h())}}),n.createElement("button",{onClick:h,disabled:u,style:{background:"#00838F",color:"white",border:"none",borderRadius:"8px",padding:"10px 14px",fontWeight:500,cursor:"pointer",opacity:u?.8:1,display:"flex",alignItems:"center",gap:"6px"}},n.createElement(i.kGk,{size:18}))))};var l=()=>n.createElement(s,null)},2140:function(e,t,r){var n={};n[r(8227)("toStringTag")]="z",e.exports="[object z]"===String(n)},2217:function(e,t,r){var n=r(9039);e.exports=function(e,t){var r=[][e];return!!r&&n(function(){r.call(null,t||function(){return 1},1)})}},3607:function(e,t,r){var n=r(2839).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},3709:function(e,t,r){var n=r(2839).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},3763:function(e,t,r){var n=r(2839);e.exports=/MSIE|Trident/.test(n)},4488:function(e,t,r){var n=r(7680),o=Math.floor,i=function(e,t){var r=e.length;if(r<8)for(var a,s,l=1;l<r;){for(s=l,a=e[l];s&&t(e[s-1],a)>0;)e[s]=e[--s];s!==l++&&(e[s]=a)}else for(var c=o(r/2),u=i(n(e,0,c),t),d=i(n(e,c),t),f=u.length,p=d.length,g=0,v=0;g<f||v<p;)e[g+v]=g<f&&v<p?t(u[g],d[v])<=0?u[g++]:d[v++]:g<f?u[g++]:d[v++];return e};e.exports=i},4606:function(e,t,r){var n=r(6823),o=TypeError;e.exports=function(e,t){if(!delete e[t])throw new o("Cannot delete property "+n(t)+" of "+n(e))}},6910:function(e,t,r){var n=r(6518),o=r(9504),i=r(9306),a=r(8981),s=r(6198),l=r(4606),c=r(655),u=r(9039),d=r(4488),f=r(2217),p=r(3709),g=r(3763),v=r(9519),m=r(3607),h=[],x=o(h.sort),b=o(h.push),y=u(function(){h.sort(void 0)}),E=u(function(){h.sort(null)}),w=f("sort"),k=!u(function(){if(v)return v<70;if(!(p&&p>3)){if(g)return!0;if(m)return m<603;var e,t,r,n,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)h.push({k:t+n,v:r})}for(h.sort(function(e,t){return t.v-e.v}),n=0;n<h.length;n++)t=h[n].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return"DGBEFHACIJK"!==o}});n({target:"Array",proto:!0,forced:y||!E||!w||!k},{sort:function(e){void 0!==e&&i(e);var t=a(this);if(k)return void 0===e?x(t):x(t,e);var r,n,o=[],u=s(t);for(n=0;n<u;n++)n in t&&b(o,t[n]);for(d(o,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:c(t)>c(r)?1:-1}}(e)),r=s(o),n=0;n<r;)t[n]=o[n++];for(;n<u;)l(t,n++);return t}})},6955:function(e,t,r){var n=r(2140),o=r(4901),i=r(2195),a=r(8227)("toStringTag"),s=Object,l="Arguments"===i(function(){return arguments}());e.exports=n?i:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=s(e),a))?r:l?i(t):"Object"===(n=i(t))&&o(t.callee)?"Arguments":n}},7680:function(e,t,r){var n=r(9504);e.exports=n([].slice)}}]);
//# sourceMappingURL=component---src-pages-members-dashboard-message-index-tsx-8dcc114f06ca370dfc50.js.map