{"version":3,"file":"component---src-pages-test-role-admin-only-tsx-700fa0ac46a204e9d68b.js","mappings":"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","sources":["webpack:///./src/componets/shared/ProtectedRoute/RoleRoutes.tsx","webpack:///./src/pages/test/role-admin-only.tsx"],"sourcesContent":["/**\n * üîê RoleRoutes ‚Äî Universal role-based route guard\n *\n * Supports two input styles:\n * \n * ‚ë† Simple string role (default)\n *    --------------------------------------------\n *    <RoleRoutes role=\"admin\">\n *      <AdminDashboard />\n *    </RoleRoutes>\n *\n *    ‚Ä¢ Only users whose role === \"admin\" can view.\n *    ‚Ä¢ Unauthenticated users ‚Üí redirected to /sign-in\n *    ‚Ä¢ Others ‚Üí redirected to `redirect` (default: /members/dashboard)\n *\n * \n * ‚ë° Advanced role object with onTrue/onFalse routes\n *    --------------------------------------------\n *    <RoleRoutes\n *      role={{\n *        admin:  { onTrue: \"/admin/home\" },\n *        member: { onFalse: \"/access-denied\" },\n *      }}\n *    >\n *      <ProtectedPage />\n *    </RoleRoutes>\n *\n *    ‚Ä¢ `onTrue`  ‚Üí redirect if user *is* that role.\n *    ‚Ä¢ `onFalse` ‚Üí redirect if user *is not* that role.\n *    ‚Ä¢ Unauthenticated ‚Üí /sign-in.\n *    ‚Ä¢ If no mapping exists ‚Üí fallback redirect used.\n */\n\nimport React, { useEffect, useState } from \"react\";\nimport { supabase } from \"../../../database/supabaseClient\";\nimport { navigate } from \"gatsby\";\n\ninterface RoleRoutesProps {\n  children:\n    | React.ReactNode\n    | ((info: {\n        allowed: boolean;\n        loading: boolean;\n        session: any;\n        role: string | null;\n      }) => React.ReactNode);\n  role?:\n    | string\n    | Record<\n        string,\n        {\n          onTrue?: string;\n          onFalse?: string;\n        }\n      >;\n  redirect?: string;\n}\n\nconst RoleRoutes: React.FC<RoleRoutesProps> = ({\n  children,\n  role = \"member\",\n  redirect = \"/members/dashboard\",\n}) => {\n  const [session, setSession] = useState<any>(null);\n  const [userRole, setUserRole] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [allowed, setAllowed] = useState(false);\n\n  useEffect(() => {\n    const checkAccess = async () => {\n      setLoading(true);\n      try {\n        const { data } = await supabase.auth.getSession();\n        const sess = data.session;\n        setSession(sess);\n\n        // (1) Not authenticated ‚Üí send to sign-in\n        if (!sess?.user) {\n          navigate(\"/sign-in\");\n          setAllowed(false);\n          setUserRole(null);\n          return;\n        }\n\n        // (2) Extract role\n        const r = sess.user.user_metadata?.role ?? \"member\";\n        setUserRole(r);\n\n        // (3) Determine access\n        if (typeof role === \"string\") {\n          setAllowed(r === role || (role === \"member\" && !!r));\n        } else {\n          const rule = role[r];\n          setAllowed(!!rule);\n        }\n      } catch (err) {\n        console.error(\"RoleRoutes check error:\", err);\n        setAllowed(false);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    checkAccess();\n  }, [role]);\n\n  const renderProps = { allowed, loading, session, role: userRole };\n\n  // Render-function support\n  if (typeof children === \"function\") {\n    return <>{(children as any)(renderProps)}</>;\n  }\n\n  // Redirect behavior\n  useEffect(() => {\n    if (loading || !userRole) return;\n\n    if (typeof role === \"string\") {\n      if (!allowed) navigate(redirect);\n    } else {\n      const rule = role[userRole];\n      if (!rule) {\n        navigate(redirect);\n      } else if (!allowed && rule.onFalse) {\n        navigate(rule.onFalse);\n      } else if (allowed && rule.onTrue) {\n        navigate(rule.onTrue);\n      }\n    }\n  }, [loading, allowed, userRole, role, redirect]);\n\n  if (loading) return null;\n  if (!allowed && typeof role === \"string\") return null;\n\n  return <>{children}</>;\n};\n\nexport default RoleRoutes;\n","\"use client\";\nimport React from \"react\";\nimport { supabase } from \"../../database/supabaseClient\";\nimport RoleRoutes from \"../../componets/shared/ProtectedRoute/RoleRoutes\";\n\nexport default function AdminOnlyPage() {\n  return (\n    <RoleRoutes role=\"admin\">\n      {({ allowed, loading, role }) => (\n        <div\n          style={{\n            background: \"#fff\",\n            color: \"#000\",\n            minHeight: \"100vh\",\n            fontFamily: \"system-ui, sans-serif\",\n            padding: 24,\n          }}\n        >\n          <h1>üõ°Ô∏è Admin Access Verification</h1>\n          <p style={{ color: \"#444\", marginBottom: 24 }}>\n            This page shows whether the current user has admin-level access.\n          </p>\n\n          <div\n            style={{\n              background: allowed\n                ? \"#e7ffe7\"\n                : loading\n                ? \"#ffffe7\"\n                : \"#ffe7e7\",\n              border: allowed\n                ? \"2px solid #0a0\"\n                : loading\n                ? \"2px solid #aa0\"\n                : \"2px solid #f33\",\n              padding: 20,\n              borderRadius: 8,\n              color: allowed\n                ? \"#064a06\"\n                : loading\n                ? \"#665500\"\n                : \"#8a0000\",\n              fontWeight: \"bold\",\n              textAlign: \"center\",\n              transition: \"all 0.3s ease\",\n            }}\n          >\n            {loading\n              ? \"‚è≥ Checking access...\"\n              : allowed\n              ? \"‚úÖ Access granted ‚Äî you are an admin.\"\n              : \"‚ùå Access denied ‚Äî you are not an admin.\"}\n          </div>\n\n          <div\n            style={{\n              marginTop: 40,\n              borderTop: \"1px solid #ccc\",\n              paddingTop: 20,\n            }}\n          >\n            <h3>üë§ Current Role</h3>\n            <pre\n              style={{\n                background: \"#111\",\n                color: \"#0f0\",\n                padding: 12,\n                borderRadius: 6,\n                fontFamily: \"monospace\",\n                fontSize: 12,\n              }}\n            >\n              {JSON.stringify({ role }, null, 2)}\n            </pre>\n          </div>\n        </div>\n      )}\n    </RoleRoutes>\n  );\n}\n"],"names":["_ref","children","role","redirect","session","setSession","useState","userRole","setUserRole","loading","setLoading","allowed","setAllowed","useEffect","async","data","supabase","auth","getSession","sess","user","navigate","r","user_metadata","_sess$user$user_metad2","rule","err","console","error","checkAccess","renderProps","React","onFalse","onTrue","AdminOnlyPage","RoleRoutes","style","background","color","minHeight","fontFamily","padding","marginBottom","border","borderRadius","fontWeight","textAlign","transition","marginTop","borderTop","paddingTop","fontSize","JSON","stringify"],"sourceRoot":""}