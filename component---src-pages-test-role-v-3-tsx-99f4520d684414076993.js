"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8717],{7878:function(e,t,r){r.r(t);var l=r(6540),n=r(6898);const o="02c567a2-b193-4009-89e5-884386540733",s="6c77d859-1af1-418e-b0e0-0d3cc4e80fad",a="d3ca3641-e106-4a4d-a288-bb3e0c4e3a9a";t.default=()=>{const{0:e,1:t}=(0,l.useState)(null),{0:r,1:c}=(0,l.useState)(null),{0:i,1:d}=(0,l.useState)(null),{0:u,1:m}=(0,l.useState)({}),{0:f,1:g}=(0,l.useState)({}),{0:p,1:h}=(0,l.useState)(!0),{0:w,1:E}=(0,l.useState)(null);return(0,l.useEffect)(()=>{(async()=>{try{var e;h(!0);const{data:r,error:l}=await n.ND.auth.getSession();if(l)throw l;const i=null==r||null===(e=r.session)||void 0===e?void 0:e.user;if(!i)throw new Error("No logged-in user found");t(i.id),c(i.email||null);const{data:u}=await n.ND.from("user_roles").select("role").eq("id",i.id).maybeSingle(),f=(null==u?void 0:u.role)||"none";d(f);const p={},w={},E=[["(1) From user1@test.com",{owner_id:o}],["(2) From admin@test.com",{owner_id:s}],["(3) From slapkommerce@gmail.com",{owner_id:a}],["(4) All member-role rows",{role:"member"}],["(5) All admin-role rows",{role:"admin"}],["(6) Select all rows",{}]];for(const[e,t]of E){let r=n.ND.from("user_private_v2").select("*");for(const[e,n]of Object.entries(t))r=r.eq(e,n);const{data:l}=await r;p[e]=l||[],w[e]=null!=l&&l.length?"‚úÖ "+l.length+" rows visible":"‚ö†Ô∏è No rows (RLS restricted)"}for(const[e,t]of Object.entries(p)){if(null==t||!t.length)continue;const r=[];let l=0,o=0,s=!1;for(const e of t){const t=new Date,a=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0"),d=a+":"+c+":"+String(t.getSeconds()).padStart(2,"0"),u=(("string"==typeof e.email?e.email.replace(/\s?\d{2}:\d{2}:\d{2}$/,""):"")+" "+d).trim(),{data:m,error:g}=await n.ND.from("test_table_2").update({email:u}).eq("id",e.id).select();g?(r.push({id:e.id,error:g.message}),o++):(r.push({id:e.id,updated_to:u}),l++,"member"===f&&e.owner_id!==i.id&&(s=!0))}let a="";a="admin"===f?"‚úÖ "+l+" success (should succeed for admin)":"member"===f?s?"‚ùå "+l+" success (should have failed for non-owned rows)":l>0?"‚úÖ "+l+" success (should succeed only on own rows)":"‚ö†Ô∏è "+o+" failed (expected for restricted rows)":o?"‚úÖ "+o+" failed (unauthenticated expected)":"‚ùå "+l+" success (should have failed)",p["WRITE TEST for "+e]=r,w["WRITE TEST for "+e]=a}m(p),g(w)}catch(r){console.error(r),E(r.message)}finally{h(!1)}})()},[]),l.createElement("div",{style:{width:"100%",minHeight:"100vh",background:"#fff"}},l.createElement("main",{style:{fontFamily:"sans-serif",padding:"2rem"}},l.createElement("h1",null,"üß© Supabase Role Access + Write Timestamp Test (test_table_2)"),p?l.createElement("p",null,"Loading..."):w?l.createElement("p",{style:{color:"red"}},"Error: ",w):l.createElement(l.Fragment,null,l.createElement("p",null,l.createElement("strong",null,"Logged in as:")," ",r),l.createElement("p",null,l.createElement("strong",null,"UID:")," ",e),l.createElement("p",null,l.createElement("strong",null,"Role (via user_roles):")," ",i),l.createElement("hr",null),Object.entries(u).map(e=>{var t,r;let[n,o]=e;return l.createElement("section",{key:n,style:{marginBottom:"2rem"}},l.createElement("h3",null,n),l.createElement("p",{style:{fontWeight:"bold",color:null!==(t=f[n])&&void 0!==t&&t.includes("‚ùå")?"red":null!==(r=f[n])&&void 0!==r&&r.includes("‚ö†Ô∏è")?"orange":"green"}},f[n]),0===o.length?l.createElement("p",{style:{color:"#999"}},"No rows visible (RLS restricted)"):l.createElement("pre",{style:{background:"#f8f8f8",padding:"1rem",borderRadius:"8px",overflowX:"auto"}},JSON.stringify(o,null,2)))}))))}}}]);
//# sourceMappingURL=component---src-pages-test-role-v-3-tsx-99f4520d684414076993.js.map