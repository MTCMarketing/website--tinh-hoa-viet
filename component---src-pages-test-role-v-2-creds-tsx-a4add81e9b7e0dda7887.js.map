{"version":3,"file":"component---src-pages-test-role-v-2-creds-tsx-a4add81e9b7e0dda7887.js","mappings":"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","sources":["webpack:///./src/pages/test/role-v2-creds.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"../../database/supabaseClient\";\n\nconst USER_IDS = {\n  member1: \"02c567a2-b193-4009-89e5-884386540733\",\n  admin:   \"6c77d859-1af1-418e-b0e0-0d3cc4e80fad\",\n  member2: \"d3ca3641-e106-4a4d-a288-bb3e0c4e3a9a\",\n};\n\ntype RoleKind = \"admin\" | \"member\" | \"unauthenticated\" | \"none\";\n\nconst TestUserCredentialsPage: React.FC = () => {\n  const [uid, setUid] = useState<string | null>(null);\n  const [email, setEmail] = useState<string>(\"(no session)\");\n  const [role, setRole] = useState<RoleKind>(\"unauthenticated\");\n  const [results, setResults] = useState<Record<string, any[]>>({});\n  const [summaries, setSummaries] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const run = async () => {\n      try {\n        setLoading(true);\n\n        // 1) Try session; DO NOT force sign-in if none\n        const { data: sessionData } = await supabase.auth.getSession();\n        const user = sessionData?.session?.user ?? null;\n\n        if (user) {\n          setUid(user.id);\n          setEmail(user.email || \"(session user)\");\n\n          // fetch app-level role\n          const { data: roleData, error: roleErr } = await supabase\n            .from(\"user_roles\")\n            .select(\"role\")\n            .eq(\"id\", user.id)\n            .maybeSingle();\n\n          if (roleErr) console.warn(\"role lookup error:\", roleErr.message);\n          const appRole = (roleData?.role as RoleKind) || \"none\";\n          setRole(appRole);\n        } else {\n          // truly public request (no Authorization header)\n          setUid(null);\n          setEmail(\"(no session)\");\n          setRole(\"unauthenticated\");\n        }\n\n        const newResults: Record<string, any[]> = {};\n        const newSummaries: Record<string, string> = {};\n\n        // 2) SELECT tests\n        const selects: Array<[string, Record<string, any>]> = [\n          [\"(1) Member 1 row\", { user_id: USER_IDS.member1 }],\n          [\"(2) Admin row\",   { user_id: USER_IDS.admin }],\n          [\"(3) Member 2 row\", { user_id: USER_IDS.member2 }],\n          [\"(4) Select all\", {}],\n        ];\n\n        for (const [label, filter] of selects) {\n          let q = supabase.from(\"user_credentials\").select(\"*\");\n          for (const [k, v] of Object.entries(filter)) q = q.eq(k, v as any);\n\n          const { data, error } = await q;\n          if (error) console.warn(`SELECT ${label} error:`, error.message);\n\n          newResults[label] = data || [];\n          newSummaries[label] =\n            data && data.length ? `‚úÖ ${data.length} row(s) visible` : \"‚ö†Ô∏è No rows (RLS restricted)\";\n        }\n\n        // 3) UPDATE tests (attempt to write any visible rows)\n        for (const [label, rows] of Object.entries(newResults)) {\n          if (!rows?.length) continue;\n\n          const updates: any[] = [];\n          let successCount = 0;\n          let errorCount = 0;\n          let wrongSuccess = false;\n\n          for (const row of rows) {\n            const newRank = `${row.rank || \"Rank\"}_${Math.floor(Math.random() * 100)}`;\n            const { error: updErr } = await supabase\n              .from(\"user_credentials\")\n              .update({ rank: newRank })\n              .eq(\"user_id\", row.user_id);\n\n            if (updErr) {\n              updates.push({ user_id: row.user_id, error: updErr.message });\n              errorCount++;\n            } else {\n              updates.push({ user_id: row.user_id, updated_rank: newRank });\n              successCount++;\n\n              // only meaningful for member checks (own-row only)\n              if (role === \"member\" && uid && row.user_id !== uid) wrongSuccess = true;\n            }\n          }\n\n          // expectation logic (self-aware)\n          let status = \"\";\n          if (role === \"admin\") {\n            status = successCount\n              ? `‚úÖ ${successCount} success (admin allowed)`\n              : `‚ö†Ô∏è ${errorCount} failed (unexpected for admin)`;\n          } else if (role === \"member\") {\n            if (wrongSuccess) {\n              status = `‚ùå ${successCount} success (should be read-only / own-row only)`;\n            } else if (successCount > 0) {\n              status = `‚ùå ${successCount} success (members should be read-only)`;\n            } else {\n              status = `‚úÖ ${errorCount} failed (expected read-only for members)`;\n            }\n          } else {\n            // unauthenticated or none\n            status = successCount\n              ? `‚ùå ${successCount} success (should fail unauthenticated)`\n              : `‚úÖ ${errorCount} failed (expected unauthenticated)`;\n          }\n\n          newResults[`UPDATE TEST for ${label}`] = updates;\n          newSummaries[`UPDATE TEST for ${label}`] = status;\n        }\n\n        setResults(newResults);\n        setSummaries(newSummaries);\n      } catch (e: any) {\n        console.error(e);\n        setError(e.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    run();\n  }, []);\n\n  return (\n    <div style={{ width: \"100%\", minHeight: \"100vh\", background: \"#fff\" }}>\n      <main style={{ fontFamily: \"sans-serif\", padding: \"2rem\" }}>\n        <h1>üß© Supabase Role Access Test ‚Äî user_credentials</h1>\n        {loading ? (\n          <p>Loading...</p>\n        ) : error ? (\n          <p style={{ color: \"red\" }}>Error: {error}</p>\n        ) : (\n          <>\n            <p><strong>Logged in as:</strong> {email}</p>\n            <p><strong>UID:</strong> {uid}</p>\n            <p><strong>Role (via user_roles):</strong> {role}</p>\n            <hr />\n            {Object.entries(results).map(([label, rows]) => (\n              <section key={label} style={{ marginBottom: \"2rem\" }}>\n                <h3>{label}</h3>\n                <p\n                  style={{\n                    fontWeight: \"bold\",\n                    color:\n                      summaries[label]?.includes(\"‚ùå\") ? \"red\" :\n                      summaries[label]?.includes(\"‚ö†Ô∏è\") ? \"orange\" :\n                      \"green\",\n                  }}\n                >\n                  {summaries[label]}\n                </p>\n                {rows.length === 0 ? (\n                  <p style={{ color: \"#999\" }}>No rows visible (RLS restricted)</p>\n                ) : (\n                  <pre\n                    style={{\n                      background: \"#f8f8f8\",\n                      padding: \"1rem\",\n                      borderRadius: \"8px\",\n                      overflowX: \"auto\",\n                    }}\n                  >\n                    {JSON.stringify(rows, null, 2)}\n                  </pre>\n                )}\n              </section>\n            ))}\n          </>\n        )}\n      </main>\n    </div>\n  );\n};\n\nexport default TestUserCredentialsPage;\n"],"names":["USER_IDS","TestUserCredentialsPage","uid","setUid","useState","email","setEmail","role","setRole","results","setResults","summaries","setSummaries","loading","setLoading","error","setError","useEffect","async","data","sessionData","supabase","auth","getSession","user","session","_sessionData$session","id","roleData","roleErr","from","select","eq","maybeSingle","console","warn","message","appRole","newResults","newSummaries","selects","user_id","label","filter","q","k","v","Object","entries","length","rows","updates","successCount","errorCount","wrongSuccess","row","newRank","rank","Math","floor","random","updErr","update","push","updated_rank","status","e","run","React","style","width","minHeight","background","fontFamily","padding","color","map","_ref","key","marginBottom","fontWeight","_summaries$label","includes","_summaries$label2","borderRadius","overflowX","JSON","stringify"],"sourceRoot":""}