{"version":3,"file":"component---src-pages-test-upload-image-tsx-338292516b9eea76a692.js","mappings":"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","sources":["webpack:///./src/pages/test/upload-image.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\n\nexport default function TestUploadImage() {\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  const [isDragging, setIsDragging] = useState(false);\n  const [isUploading, setIsUploading] = useState(false);\n\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n\n  const [log, setLog] = useState<string>(\"\");\n  const [result, setResult] = useState<any>(null);\n\n  const [webpUrl, setWebpUrl] = useState<string | null>(null);\n  const [webpReady, setWebpReady] = useState(false);\n\n  const endpoint =\n    \"https://curly-pond-edc4.snowy-frost-b196.workers.dev/api/upload-image\";\n\n  const REPO_PAGES_BASE = \"https://mtcmarketing.github.io/images--tinh-hoa-viet\";\n\n  const writeLog = (msg: string) => {\n    setLog((prev) => (prev ? prev + \"\\n\" + msg : msg));\n  };\n\n  const buildWebpUrlFromUploadPath = (uploadPath: string) => {\n    // uploadPath = \"originals/1768592255761-cuisine2.png\"\n    const filename = uploadPath.split(\"/\").pop() || \"\";\n    const dotIndex = filename.lastIndexOf(\".\");\n    const baseName = dotIndex >= 0 ? filename.slice(0, dotIndex) : filename;\n\n    // GitHub Actions outputs: images/<same-base>.webp\n    // Add cache buster because Cloudflare/GitHub can be annoying\n    return `${REPO_PAGES_BASE}/images/${baseName}.webp?v=${Date.now()}`;\n  };\n\n  const checkUrlExists = async (url: string) => {\n    try {\n      const res = await fetch(url, { method: \"HEAD\" });\n      return res.ok;\n    } catch {\n      return false;\n    }\n  };\n\n  const waitForWebp = async (url: string) => {\n    setWebpReady(false);\n    writeLog(\"üïµÔ∏è Waiting for WEBP output...\");\n\n    const maxAttempts = 30; // ~60s total\n    const delayMs = 2000;\n\n    for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n      const ok = await checkUrlExists(url);\n      if (ok) {\n        writeLog(`‚úÖ WEBP ready! (${attempt}/${maxAttempts})`);\n        setWebpReady(true);\n        return;\n      }\n\n      writeLog(`‚è≥ Not ready yet... (${attempt}/${maxAttempts})`);\n      await new Promise((r) => setTimeout(r, delayMs));\n    }\n\n    writeLog(\"‚ùå WEBP not found after waiting. Action may still be running.\");\n  };\n\n  const pickFile = (file: File | null) => {\n    if (!file) return;\n\n    if (!file.type.startsWith(\"image/\")) {\n      writeLog(`‚ùå Not an image: ${file.type || \"unknown\"}`);\n      return;\n    }\n\n    setSelectedFile(file);\n    setResult(null);\n    setLog(\"\");\n    setWebpUrl(null);\n    setWebpReady(false);\n\n    const url = URL.createObjectURL(file);\n    setPreviewUrl(url);\n\n    writeLog(`üì¶ Selected: ${file.name} (${Math.round(file.size / 1024)} KB)`);\n  };\n\n  const uploadFile = async (file: File) => {\n    setIsUploading(true);\n    setResult(null);\n    setWebpUrl(null);\n    setWebpReady(false);\n\n    try {\n      writeLog(\"‚è≥ Uploading...\");\n\n      const form = new FormData();\n      form.append(\"file\", file);\n\n      const res = await fetch(endpoint, {\n        method: \"POST\",\n        body: form,\n      });\n\n      const text = await res.text();\n\n      let json: any = null;\n      try {\n        json = JSON.parse(text);\n      } catch {\n        // response wasn't json\n      }\n\n      if (!res.ok) {\n        writeLog(`‚ùå Upload failed (HTTP ${res.status})`);\n        writeLog(text);\n        return;\n      }\n\n      writeLog(\"‚úÖ Upload success!\");\n      setResult(json);\n\n      if (json?.pagesUrl) writeLog(`üåç pagesUrl: ${json.pagesUrl}`);\n      if (json?.downloadUrl) writeLog(`‚¨áÔ∏è downloadUrl: ${json.downloadUrl}`);\n      if (json?.path) writeLog(`üìÅ path: ${json.path}`);\n      if (json?.sha) writeLog(`üîë sha: ${json.sha}`);\n\n      // Build expected WEBP URL and poll for it\n      if (json?.path) {\n        const expectedWebp = buildWebpUrlFromUploadPath(json.path);\n        setWebpUrl(expectedWebp);\n        writeLog(`üß† Expected WEBP: ${expectedWebp}`);\n        await waitForWebp(expectedWebp);\n      }\n    } catch (err: any) {\n      writeLog(`‚ùå Upload error: ${err?.message || String(err)}`);\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const onDrop = async (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n\n    const file = e.dataTransfer.files?.[0];\n    if (!file) return;\n\n    pickFile(file);\n    await uploadFile(file);\n  };\n\n  const onBrowse = () => {\n    inputRef.current?.click();\n  };\n\n  const onFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0] || null;\n    if (!file) return;\n\n    pickFile(file);\n    await uploadFile(file);\n  };\n\n  return (\n    <div\n      style={{\n        width: \"100%\",\n        height: \"100vh\",\n        backgroundColor: \"white\",\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        padding: 20,\n        boxSizing: \"border-box\",\n        fontFamily: \"system-ui, Arial\",\n      }}\n    >\n      <div\n        style={{\n          width: \"min(720px, 100%)\",\n          border: \"1px solid #ddd\",\n          borderRadius: 12,\n          padding: 18,\n          boxShadow: \"0 10px 30px rgba(0,0,0,0.06)\",\n        }}\n      >\n        <h2 style={{ margin: 0, marginBottom: 6 }}>Upload Image</h2>\n        <div style={{ fontSize: 13, color: \"#555\", marginBottom: 14 }}>\n          Drag & drop an image, or click to upload. It will POST to your Worker,\n          then wait for GitHub Actions to generate the WEBP.\n        </div>\n\n        <div\n          onClick={onBrowse}\n          onDrop={onDrop}\n          onDragOver={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            setIsDragging(true);\n          }}\n          onDragLeave={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            setIsDragging(false);\n          }}\n          style={{\n            cursor: \"pointer\",\n            userSelect: \"none\",\n            border: `2px dashed ${isDragging ? \"#000\" : \"#bbb\"}`,\n            borderRadius: 12,\n            padding: 18,\n            textAlign: \"center\",\n            background: isDragging ? \"rgba(0,0,0,0.03)\" : \"#fafafa\",\n          }}\n        >\n          <input\n            ref={inputRef}\n            type=\"file\"\n            accept=\"image/*\"\n            style={{ display: \"none\" }}\n            onChange={onFileChange}\n          />\n\n          <div style={{ fontSize: 14, fontWeight: 600 }}>\n            {isUploading ? \"Uploading...\" : \"Drop image here or click to upload\"}\n          </div>\n\n          <div style={{ fontSize: 12, color: \"#666\", marginTop: 6 }}>\n            Endpoint: <code>{endpoint}</code>\n          </div>\n\n          {selectedFile && (\n            <div style={{ marginTop: 10, fontSize: 12, color: \"#444\" }}>\n              Selected: <b>{selectedFile.name}</b>\n            </div>\n          )}\n        </div>\n\n        {previewUrl && (\n          <div style={{ marginTop: 14 }}>\n            <div style={{ fontSize: 13, marginBottom: 8, color: \"#333\" }}>\n              Original Preview\n            </div>\n            <img\n              src={previewUrl}\n              alt=\"preview\"\n              style={{\n                width: \"100%\",\n                maxHeight: 260,\n                objectFit: \"contain\",\n                borderRadius: 10,\n                border: \"1px solid #eee\",\n                background: \"white\",\n              }}\n            />\n          </div>\n        )}\n\n        {webpUrl && (\n          <div style={{ marginTop: 14 }}>\n            <div style={{ fontSize: 13, marginBottom: 8, color: \"#333\" }}>\n              WEBP Output {webpReady ? \"‚úÖ\" : \"‚è≥\"}\n            </div>\n\n            {webpReady ? (\n              <>\n                <img\n                  src={webpUrl}\n                  alt=\"webp preview\"\n                  style={{\n                    width: \"100%\",\n                    maxHeight: 260,\n                    objectFit: \"contain\",\n                    borderRadius: 10,\n                    border: \"1px solid #eee\",\n                    background: \"white\",\n                  }}\n                />\n                <div style={{ marginTop: 8, fontSize: 13 }}>\n                  WEBP URL:{\" \"}\n                  <a href={webpUrl} target=\"_blank\" rel=\"noreferrer\">\n                    {webpUrl}\n                  </a>\n                </div>\n              </>\n            ) : (\n              <div style={{ fontSize: 12, color: \"#666\" }}>\n                Waiting for GitHub Actions to finish processing...\n              </div>\n            )}\n          </div>\n        )}\n\n        <div style={{ marginTop: 14 }}>\n          <div style={{ fontSize: 13, marginBottom: 6, color: \"#333\" }}>\n            Console\n          </div>\n          <pre\n            style={{\n              background: \"#0b0b0d\",\n              color: \"#d9d9d9\",\n              padding: 12,\n              borderRadius: 10,\n              fontSize: 12,\n              minHeight: 120,\n              overflow: \"auto\",\n              whiteSpace: \"pre-wrap\",\n              lineHeight: 1.35,\n            }}\n          >\n            {log || \"Drop an image to start...\"}\n          </pre>\n        </div>\n\n        {result?.downloadUrl && (\n          <div style={{ marginTop: 10, fontSize: 13 }}>\n            Original downloadUrl:{\" \"}\n            <a href={result.downloadUrl} target=\"_blank\" rel=\"noreferrer\">\n              {result.downloadUrl}\n            </a>\n          </div>\n        )}\n\n        {result?.pagesUrl && (\n          <div style={{ marginTop: 6, fontSize: 13 }}>\n            Original pagesUrl:{\" \"}\n            <a href={result.pagesUrl} target=\"_blank\" rel=\"noreferrer\">\n              {result.pagesUrl}\n            </a>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":["TestUploadImage","inputRef","useRef","isDragging","setIsDragging","useState","isUploading","setIsUploading","selectedFile","setSelectedFile","previewUrl","setPreviewUrl","log","setLog","result","setResult","webpUrl","setWebpUrl","webpReady","setWebpReady","endpoint","writeLog","msg","prev","checkUrlExists","async","fetch","url","method","ok","pickFile","file","type","startsWith","URL","createObjectURL","name","Math","round","size","uploadFile","form","FormData","append","res","body","text","json","JSON","parse","status","_json","pagesUrl","_json2","downloadUrl","_json3","path","_json4","sha","_json5","expectedWebp","uploadPath","filename","split","pop","dotIndex","lastIndexOf","REPO_PAGES_BASE","slice","Date","now","buildWebpUrlFromUploadPath","attempt","Promise","r","setTimeout","waitForWebp","err","message","String","React","style","width","height","backgroundColor","display","justifyContent","alignItems","padding","boxSizing","fontFamily","border","borderRadius","boxShadow","margin","marginBottom","fontSize","color","onClick","onBrowse","current","_inputRef$current","click","onDrop","e","preventDefault","stopPropagation","dataTransfer","files","_e$dataTransfer$files","onDragOver","onDragLeave","cursor","userSelect","textAlign","background","ref","accept","onChange","target","_e$target$files","fontWeight","marginTop","src","alt","maxHeight","objectFit","href","rel","minHeight","overflow","whiteSpace","lineHeight"],"sourceRoot":""}