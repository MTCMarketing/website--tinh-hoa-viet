"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[744],{8730:function(e,t,a){a.r(t),a.d(t,{default:function(){return i}});var l=a(5458),s=a(6540),n=a(6898);const r=[{label:"admin",email:"admin@tinhhoaviet.org.vn",password:"FPyV9sXAxX9XhK4"},{label:"member_user1",email:"user1@test.com",password:"password1"},{label:"member_slapkommerce",email:"slapkommerce@gmail.com",password:"password1"}];function i(){const{0:e,1:t}=(0,s.useState)([]),a=e=>t(t=>[].concat((0,l.A)(t),["["+(new Date).toLocaleTimeString()+"] "+e]));return s.createElement("div",{style:{fontFamily:"monospace",padding:20,maxWidth:900,margin:"auto",color:"#eee"}},s.createElement("h2",null,"ğŸ”’ DM Access Test (Admin â†” Member Visibility)"),s.createElement("div",{style:{display:"flex",gap:8,flexWrap:"wrap"}},r.map(e=>s.createElement("button",{key:e.email,onClick:()=>(async e=>{a("\n=== Testing as "+e.label+" ===");try{var t;const{error:s}=await n.ND.auth.signInWithPassword({email:e.email,password:e.password});if(s)return void a("âŒ Login failed for "+e.email+": "+s.message);const{data:{user:r}}=await n.ND.auth.getUser(),i=null!==(t=null==r?void 0:r.id)&&void 0!==t?t:"unknown";a("âœ… Logged in as "+e.email+" (uid: "+i+")"),a("ğŸ” SELECT * FROM dm_messages");const{data:o,error:c}=await n.ND.from("dm_messages").select("*").order("created_at",{ascending:!1});var l;c?a("ğŸš« Read error: "+c.message):(a("ğŸ“¨ Retrieved "+(null!==(l=null==o?void 0:o.length)&&void 0!==l?l:0)+" message(s) visible to "+e.label),null!=o&&o.length?a("ğŸ§¾ Sample:\n"+JSON.stringify(o.slice(0,3),null,2)):a("â„¹ï¸ No messages visible (likely correct for restricted user)"));const m="6c77d859-1af1-418e-b0e0-0d3cc4e80fad",d="d3ca3641-e106-4a4d-a288-bb3e0c4e3a9a";a("ğŸ” Checking if "+e.label+" can read message between ADMIN â†’ slapkommerce");const{data:u,error:g}=await n.ND.from("dm_messages").select("*").eq("sender_id",m).eq("recipient_id",d);g?a("ğŸš« Direct query failed: "+g.message):u&&u.length>0?a("âš ï¸ SECURITY ALERT: "+e.label+" can see "+u.length+" message(s) between admin and slapkommerce!"):a("âœ… Access denied (as expected â€” cannot read othersâ€™ DMs)"),await n.ND.auth.signOut(),a("--- End test for "+e.label+" --- âœ…")}catch(s){a("âŒ Unexpected error for "+e.label+": "+s.message),console.error(s),await n.ND.auth.signOut()}})(e),style:{padding:"8px 12px",background:"#333",border:"1px solid #555",borderRadius:6,cursor:"pointer",color:"lime"}},"Test as ",e.label))),s.createElement("pre",{style:{background:"#000",color:"#0f0",padding:15,borderRadius:8,marginTop:20,height:400,fontSize:12,overflowY:"auto",whiteSpace:"pre-wrap"}},e.join("\n")),s.createElement("div",{style:{background:"#111",border:"1px solid #333",borderRadius:8,padding:20,marginTop:15,lineHeight:1.6}},s.createElement("h3",{style:{color:"gold"}},"ğŸ§­ What this test does"),s.createElement("ul",{style:{paddingLeft:20,fontSize:12}},s.createElement("li",null,"Logs in as three roles: ",s.createElement("b",null,"admin"),", ",s.createElement("b",null,"member_user1"),", and"," ",s.createElement("b",null,"member_slapkommerce"),"."),s.createElement("li",null,"Each user runs ",s.createElement("code",null,"SELECT * FROM dm_messages")," to see which messages are visible under Row Level Security."),s.createElement("li",null,"It specifically checks whether"," ",s.createElement("b",null,"user1@test.com")," can see the private DM between"," ",s.createElement("b",null,"admin@tinhhoaviet.org.vn")," and"," ",s.createElement("b",null,"slapkommerce@gmail.com"),".")),s.createElement("br",null),s.createElement("h3",{style:{color:"lime"}},"âœ… Expected Results (Correct Behavior)"),s.createElement("ul",{style:{paddingLeft:20,fontSize:12}},s.createElement("li",null,s.createElement("b",null,"Admin")," â€” Sees ",s.createElement("i",null,"all")," DM messages in the system."),s.createElement("li",null,s.createElement("b",null,"Member (slapkommerce)")," â€” Sees only their own conversation with admin."),s.createElement("li",null,s.createElement("b",null,"Member (user1)")," â€” Sees only their own messages; cannot see messages between admin and other users.")),s.createElement("br",null),s.createElement("h3",{style:{color:"red"}},"ğŸš¨ Security Alert Indicators"),s.createElement("p",{style:{marginLeft:20,fontSize:12}},"If you see a line like"," ",s.createElement("code",null,"âš ï¸ SECURITY ALERT: user1 can see messages between admin and slapkommerce"),", that means your RLS policy is too permissive and should be reviewed."),s.createElement("br",null),s.createElement("p",{style:{marginTop:10,color:"#ccc",fontSize:12}},"This component acts as a live verification tool â€” if all tests log â€œâœ… Access denied (as expected)â€ for unrelated users, your messaging privacy setup is solid. ğŸ›¡ï¸")))}}}]);
//# sourceMappingURL=component---src-pages-test-dm-access-tsx-f5a690a97fd78bf24b5f.js.map