{"version":3,"file":"component---src-pages-sign-in-tsx-fdd4f235187040a4ce59.js","mappings":"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","sources":["webpack:///./src/database/functions.ts","webpack:///./src/database/session-repair.ts","webpack:///./src/componets/log-in/login.tsx","webpack:///./src/pages/sign-in.tsx"],"sourcesContent":["import { clearStaleSupabaseKeys } from \"./session-repair\";\nimport { supabase } from \"./supabaseClient\";\n\n\n\n\n\n\nexport const handleLogout = async ({ onSuccess, onFail } = {}) => {\n  console.log(\"üîê Logging out‚Ä¶\");\n\n  // Remove corrupted keys ONLY\n  clearStaleSupabaseKeys();\n\n  // Call Supabase logout\n  const { error } = await supabase.auth.signOut();\n\n  if (error) {\n    console.error(\"‚ùå Logout error:\", error);\n    return onFail?.(error.message);\n  }\n\n  // Clear *all* session keys (safe now)\n  clearStaleSupabaseKeys();\n\n  // Optionally wipe saved session map\n  localStorage.removeItem(\"__thv_valid_supabase_keys__\");\n\n  onSuccess?.();\n};\n\n\n\n\n\nexport const handleSignup = async ({\n  email,\n  password,\n  fullName,\n  onSuccess,\n  onFail,\n}: {\n  email: string\n  password: string\n  fullName?: string\n  onSuccess?: () => void\n  onFail?: (error?: string) => void\n}) => {\n  const { data, error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      data: {\n        full_name: fullName || \"unknown\",\n        signup_source: \"thv-web\", // optional\n      },\n    },\n  })\n\n  if (error) onFail?.(error.message)\n  else onSuccess?.()\n}\n\n\nexport const handleLogin = async (\n  { email, password, onSuccess, onFail }: {\n    email: string\n    password: string\n    onSuccess?: () => void\n    onFail?: (error?: string) => void\n  }\n) => {\n  const { data, error } = await supabase.auth.signInWithPassword({ email, password })\n  if (error) onFail?.(error.message)\n  else onSuccess?.()\n}\n\nexport const handleResetPassword = async (\n  { email, onSuccess, onFail }: {\n    email: string\n    onSuccess?: () => void\n    onFail?: (error?: string) => void\n  }\n) => {\n  const { data, error } = await supabase.auth.resetPasswordForEmail(email)\n  if (error) onFail?.(error.message)\n  else onSuccess?.()\n}\n\nexport const handleUpdatePassword = async (\n  { newPassword, onSuccess, onFail }: {\n    newPassword: string\n    onSuccess?: () => void\n    onFail?: (error?: string) => void\n  }\n) => {\n  const { data, error } = await supabase.auth.updateUser({ password: newPassword })\n  if (error) onFail?.(error.message)\n  else onSuccess?.()\n}\n\n\n\nexport interface UpdateUserData {\n  fullName?: string;\n  phone?: string;\n  email?: string;\n  dob?: string;\n  address?: string;\n  hometown?: string;\n  field?: string;\n  goals?: string;\n  vision?: string;\n  status?: string;\n  avatar?: string;\n}\n\n/**\n * Updates user profile data across both tables: user_member & user_private\n * Automatically maps field names to Supabase column names.\n */\nexport const updateUserProfile = async (updates: UpdateUserData) => {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) throw new Error('Not logged in');\n\n    const memberPayload: any = {};\n    const privatePayload: any = {};\n\n    if (updates.fullName) memberPayload.full_name = updates.fullName;\n    if (updates.hometown) memberPayload.hometown = updates.hometown;\n    if (updates.field) memberPayload.field_of_expertise = updates.field;\n    if (updates.status) memberPayload.profile_status = updates.status;\n    if (updates.avatar) memberPayload.avatar_url = updates.avatar;\n\n    if (updates.phone) privatePayload.phone = updates.phone;\n    if (updates.email) privatePayload.email = updates.email;\n    if (updates.address) privatePayload.address = updates.address;\n    if (updates.dob) privatePayload.dob = updates.dob;\n    if (updates.goals) privatePayload.personal_goals = updates.goals;\n    if (updates.vision) privatePayload.future_vision = updates.vision;\n\n    // Run updates separately depending on which data is provided\n    if (Object.keys(memberPayload).length > 0)\n      await supabase.from('user_member').update(memberPayload).eq('id', user.id);\n\n    if (Object.keys(privatePayload).length > 0)\n      await supabase.from('user_private').update(privatePayload).eq('id', user.id);\n\n    return { success: true };\n  } catch (error) {\n    console.error('Update user profile failed:', error);\n    return { success: false, error };\n  }\n};\n","export function getSupabaseAuthKeys() {\n  return Object.keys(localStorage).filter(k =>\n    k.startsWith(\"sb-\") && k.includes(\"-auth-token\")\n  );\n}\n\n// Save session keys after successful login\nexport function saveValidSupabaseKeys() {\n  const keys = getSupabaseAuthKeys();\n  if (keys.length === 0) return;\n\n  const store: Record<string, string> = {};\n  keys.forEach(k => (store[k] = localStorage.getItem(k) || \"\"));\n\n  localStorage.setItem(\"__thv_valid_supabase_keys__\", JSON.stringify(store));\n}\n\n// Restore missing / damaged keys BEFORE login\nexport function repairSupabaseKeysIfBroken() {\n  const saved = localStorage.getItem(\"__thv_valid_supabase_keys__\");\n  if (!saved) return;\n\n  const good = JSON.parse(saved);\n  Object.keys(good).forEach(k => {\n    if (!localStorage.getItem(k)) {\n      console.log(\"üõ† Restoring missing Supabase key:\", k);\n      localStorage.setItem(k, good[k]);\n    }\n  });\n}\n\n// Remove corrupted keys\nexport function clearStaleSupabaseKeys() {\n  const saved = JSON.parse(localStorage.getItem(\"__thv_valid_supabase_keys__\") || \"{}\");\n  const current = getSupabaseAuthKeys();\n\n  current.forEach(k => {\n    if (!saved[k]) {\n      console.log(\"üß® Removing stale Supabase key:\", k);\n      localStorage.removeItem(k);\n    }\n  });\n}\n","/**\n * üîê FIXED LOGIN ‚Äî Clean, Stable, No UI Changes\n *\n * - Clears ONLY stale Supabase keys BEFORE login attempt\n * - Does NOT touch valid tokens created after login\n * - Works with self-hosted GoTrue\n * - No UI damage\n * - Full debug logs\n */\n\nimport React, { useState, useEffect } from \"react\";\nimport { navigate } from \"gatsby\";\nimport \"./login.css\";\nimport { FiArrowRight } from \"react-icons/fi\";\nimport { supabase } from \"../../database/supabaseClient\";\nimport { handleLogin } from \"../../database/functions\";\nimport { repairSupabaseKeysIfBroken, saveValidSupabaseKeys } from \"../../database/session-repair\";\n\ninterface LoginProps {\n  route?: Record<\n    string,\n    {\n      onTrue?: string;\n      onFalse?: string;\n    }\n  >;\n}\n\nconst i18n = {\n  EN: {\n    brandTitle: \"TINH HOA VI·ªÜT\",\n    tagline: \"Where Vietnamese Excellence Meets Global Recognition\",\n    features: [\n      \"Premium Vietnamese Heritage\",\n      \"Global Excellence Standards\",\n      \"Elite Community Access\",\n    ],\n    title: \"Welcome Back\",\n    subtitle: \"Log in to continue your journey of excellence\",\n    email: \"Email Address\",\n    password: \"Password\",\n    remember: \"Remember Me\",\n    forgot: \"Forgot Password?\",\n    submit: \"Sign In\",\n    noAccount: \"Don't have an account? \",\n    signup: \"Create One Now\",\n    langEN: \"EN\",\n    langVN: \"VN\",\n  },\n  VN: {\n    brandTitle: \"TINH HOA VI·ªÜT\",\n    tagline: \"N∆°i t√¥n vinh tinh hoa Vi·ªát Nam v∆∞∆°n t·∫ßm qu·ªëc t·∫ø\",\n    features: [\n      \"Di s·∫£n Vi·ªát Nam ƒë·∫≥ng c·∫•p\",\n      \"Chu·∫©n m·ª±c xu·∫•t s·∫Øc to√†n c·∫ßu\",\n      \"C·ªông ƒë·ªìng tinh hoa\",\n    ],\n    title: \"Ch√†o m·ª´ng tr·ªü l·∫°i\",\n    subtitle: \"ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c h√†nh tr√¨nh tinh hoa\",\n    email: \"ƒê·ªãa ch·ªâ Email\",\n    password: \"M·∫≠t kh·∫©u\",\n    remember: \"Ghi nh·ªõ ƒëƒÉng nh·∫≠p\",\n    forgot: \"Qu√™n m·∫≠t kh·∫©u?\",\n    submit: \"ƒêƒÉng Nh·∫≠p\",\n    noAccount: \"Ch∆∞a c√≥ t√†i kho·∫£n? \",\n    signup: \"T·∫°o t√†i kho·∫£n ngay\",\n    langEN: \"EN\",\n    langVN: \"VN\",\n  },\n};\n\nconst Login: React.FC<LoginProps> = ({ route }) => {\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\",\n    remember: false,\n  });\n\n  const [language, setLanguage] = useState<\"EN\" | \"VN\">(\"EN\");\n  const [message, setMessage] = useState(\"\");\n  const t = i18n[language];\n\n  // -----------------------------------------------------\n  // üü¶ AUTO-REDIRECT IF ALREADY LOGGED IN\n  // -----------------------------------------------------\n  useEffect(() => {\n    supabase.auth.getSession().then(({ data }) => {\n      console.log(\"üîç Login page mount ‚Äî existing session:\", data);\n      const role = data.session?.user?.user_metadata?.role;\n      if (data.session) handleRedirect(role);\n    });\n  }, []);\n\n  // -----------------------------------------------------\n  // üüß ROLE-BASED REDIRECT\n  // -----------------------------------------------------\n  const handleRedirect = (role?: string | null) => {\n    console.log(\"‚û°Ô∏è Redirect with role:\", role);\n\n    if (role && route?.[role]?.onTrue) return navigate(route[role].onTrue!);\n    if (role && route?.[role]?.onFalse) return navigate(route[role].onFalse!);\n\n    navigate(\"/event/aid/checkout\");\n  };\n\n  // -----------------------------------------------------\n  // üßΩ CLEAR ONLY STALE KEYS BEFORE LOGIN\n  // -----------------------------------------------------\n  const clearStaleSupabaseKeys = () => {\n    console.log(\"üßπ Clearing stale Supabase keys BEFORE login‚Ä¶\");\n    const keys = Object.keys(localStorage);\n\n    keys.forEach((key) => {\n      if (key.startsWith(\"sb-\")) {\n        console.log(\"üß® Removing stale key:\", key);\n        localStorage.removeItem(key);\n      }\n    });\n\n    console.log(\"üì¶ localStorage AFTER wipe:\", Object.keys(localStorage));\n  };\n\n  // -----------------------------------------------------\n  // üü© LOGIN SUCCESS HANDLER\n  // -----------------------------------------------------\n\n  const onSuccess = async () => {\n    console.log(\"‚úÖ Login succeeded ‚Äî verifying session‚Ä¶\");\n\n    const { data } = await supabase.auth.getSession();\n    console.log(\"üîê Fresh session:\", data);\n\n    // SAVE THE NEW SESSION KEYS\n    saveValidSupabaseKeys();\n\n    const role = data.session?.user?.user_metadata?.role;\n    setMessage(\"Login successful!\");\n\n    setTimeout(() => handleRedirect(role), 900);\n  };\n\n\n  const onFail = (err?: string) => {\n    console.log(\"‚ùå Login failed:\", err);\n    setMessage(\"‚ùå \" + (err || \"Invalid credentials.\"));\n  };\n\n  // -----------------------------------------------------\n  // üì• INPUT BINDING\n  // -----------------------------------------------------\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value, type, checked } = e.target;\n    setFormData((prev) => ({\n      ...prev,\n      [name]: type === \"checkbox\" ? checked : value,\n    }));\n  };\n\n  // -----------------------------------------------------\n  // üöÄ SUBMIT LOGIN\n  // -----------------------------------------------------\nconst handleSubmit = (e: any) => {\n  e.preventDefault();\n\n  // Fix missing keys BEFORE login\n  repairSupabaseKeysIfBroken();\n\n  // Remove corrupted ones\n  clearStaleSupabaseKeys();\n\n  // Use proper scoped values\n  handleLogin({\n    email: formData.email,\n    password: formData.password,\n    onSuccess,\n    onFail,\n  });\n};\n\n\n  // -----------------------------------------------------\n  // üé® UI (unchanged)\n  // -----------------------------------------------------\n  return (\n    <div className=\"auth-shell\">\n      <aside className=\"brand-side\" aria-hidden>\n        <div className=\"brand-sheen\" />\n        <div className=\"brand-pattern\" />\n        <div className=\"brand-wrap\">\n          <h1 className=\"brand-name\">{t.brandTitle}</h1>\n          <p className=\"brand-tag\">{t.tagline}</p>\n          <ul className=\"brand-features\">\n            {t.features.map((f, i) => (\n              <li className=\"feature\" key={i}>\n                <span className=\"tick\">‚úì</span>\n                <span>{f}</span>\n              </li>\n            ))}\n          </ul>\n        </div>\n      </aside>\n\n      <main className=\"form-side\">\n        <header className=\"form-top\">\n          <div className=\"lang-switch\">\n            <button\n              className={`lang ${language === \"EN\" ? \"active\" : \"\"}`}\n              onClick={() => setLanguage(\"EN\")}\n            >\n              {t.langEN}\n            </button>\n            <span className=\"mid\">|</span>\n            <button\n              className={`lang ${language === \"VN\" ? \"active\" : \"\"}`}\n              onClick={() => setLanguage(\"VN\")}\n            >\n              {t.langVN}\n            </button>\n          </div>\n        </header>\n\n        <section className=\"form-wrap\">\n          <div className=\"intro\">\n            <h2 className=\"title\">{t.title}</h2>\n            <p className=\"subtitle\">{t.subtitle}</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"auth-form\">\n            <div className=\"field\">\n              <label htmlFor=\"email\">{t.email}</label>\n              <input\n                type=\"email\"\n                id=\"email\"\n                name=\"email\"\n                value={formData.email}\n                onChange={handleChange}\n                placeholder={\n                  language === \"EN\"\n                    ? \"your.email@example.com\"\n                    : \"email@vi-du.com\"\n                }\n                required\n              />\n            </div>\n\n            <div className=\"field\">\n              <label htmlFor=\"password\">{t.password}</label>\n              <input\n                type=\"password\"\n                id=\"password\"\n                name=\"password\"\n                value={formData.password}\n                onChange={handleChange}\n                placeholder={\n                  language === \"EN\"\n                    ? \"Enter your password\"\n                    : \"Nh·∫≠p m·∫≠t kh·∫©u\"\n                }\n                required\n              />\n            </div>\n\n            <div className=\"options\">\n              <label className=\"remember\">\n                <input\n                  type=\"checkbox\"\n                  name=\"remember\"\n                  checked={formData.remember}\n                  onChange={handleChange}\n                />\n                {t.remember}\n              </label>\n              <a href=\"/reset-password\" className=\"forgot\">\n                {t.forgot}\n              </a>\n            </div>\n\n            <button type=\"submit\" className=\"cta\">\n              <span>{t.submit}</span>\n              <FiArrowRight className=\"arrow\" />\n            </button>\n\n            {message && (\n              <p\n                style={{\n                  textAlign: \"center\",\n                  marginTop: 10,\n                  color: \"#fff\",\n                }}\n              >\n                {message}\n              </p>\n            )}\n\n            <p className=\"switch\">\n              {t.noAccount}\n              <a href=\"/sign-up\">{t.signup}</a>\n            </p>\n          </form>\n        </section>\n      </main>\n    </div>\n  );\n};\n\nexport default Login;\n","import React from 'react'\nimport Login from '../componets/log-in/login'\n\nconst Signin= () => {\n  return (\n    <div>\n        <Login route={{ \n          \"admin\": { onTrue : '/cms'}\n        }}/>\n    </div>\n  )\n}\n\nexport default Signin\n"],"names":["handleLogout","async","onSuccess","onFail","console","log","clearStaleSupabaseKeys","error","supabase","auth","signOut","message","localStorage","removeItem","handleSignup","email","password","fullName","data","signUp","options","full_name","signup_source","handleLogin","signInWithPassword","handleResetPassword","resetPasswordForEmail","handleUpdatePassword","newPassword","updateUser","getSupabaseAuthKeys","Object","keys","filter","k","startsWith","includes","saveValidSupabaseKeys","length","store","forEach","getItem","setItem","JSON","stringify","repairSupabaseKeysIfBroken","saved","good","parse","i18n","EN","brandTitle","tagline","features","title","subtitle","remember","forgot","submit","noAccount","signup","langEN","langVN","VN","_ref","route","formData","setFormData","useState","language","setLanguage","setMessage","t","useEffect","getSession","then","_ref2","role","session","_data$session","user","_data$session$user","user_metadata","_data$session$user$us","handleRedirect","_route$role","onTrue","navigate","_route$role2","onFalse","_data$session2","_data$session2$user","_data$session2$user$u","setTimeout","err","handleChange","e","name","value","type","checked","target","prev","React","className","map","f","i","key","onClick","onSubmit","preventDefault","htmlFor","id","onChange","placeholder","required","href","FiArrowRight","style","textAlign","marginTop","color","Signin","Login"],"sourceRoot":""}