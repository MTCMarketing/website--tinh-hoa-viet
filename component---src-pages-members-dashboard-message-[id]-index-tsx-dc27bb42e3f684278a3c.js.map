{"version":3,"file":"component---src-pages-members-dashboard-message-[id]-index-tsx-dc27bb42e3f684278a3c.js","mappings":"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","sources":["webpack:///./src/componets/messaging/SendDirectMessage.tsx","webpack:///./src/pages/members/dashboard/message/[id]/index.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { FiSend, FiPaperclip, FiTrash2 } from \"react-icons/fi\";\nimport { supabase } from \"../../database/supabaseClient\";\n\nexport const SendDirectMessage: React.FC = () => {\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState<any[]>([]);\n  const [attachments, setAttachments] = useState<File[]>([]);\n  const [sending, setSending] = useState(false);\n  const [currentUserId, setCurrentUserId] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const chatEndRef = useRef<HTMLDivElement>(null);\n\n  /* ------------------------------\n     Load current user once\n  ------------------------------ */\n  useEffect(() => {\n    supabase.auth.getSession().then(({ data }) => {\n      const uid = data.session?.user?.id ?? null;\n      setCurrentUserId(uid);\n    });\n  }, []);\n\n  /* ------------------------------\n     Fetch existing messages\n  ------------------------------ */\n  useEffect(() => {\n    const fetchMessages = async () => {\n      const { data: session } = await supabase.auth.getSession();\n      const user = session?.session?.user;\n      if (!user) return;\n\n      const { data, error } = await supabase\n        .from(\"dm_messages\")\n        .select(\"*\")\n        .or(`sender_id.eq.${user.id},recipient_id.eq.${user.id}`)\n        .order(\"created_at\", { ascending: true });\n\n      if (!error && data) setMessages(data);\n    };\n\n    fetchMessages();\n  }, []);\n\n  /* ------------------------------\n     Auto-scroll on new messages\n  ------------------------------ */\n  useEffect(() => {\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  /* ------------------------------\n     File attachments\n  ------------------------------ */\n  const handleAttach = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) {\n      const newFiles = Array.from(e.target.files);\n      setAttachments((prev) => [...prev, ...newFiles]);\n    }\n  };\n\n  const handleRemove = (index: number) => {\n    setAttachments((prev) => prev.filter((_, i) => i !== index));\n  };\n\n  /* ------------------------------\n     Send message\n  ------------------------------ */\n  const handleSend = async () => {\n    if (!message.trim() && attachments.length === 0) return;\n\n    setSending(true);\n    try {\n      const { data: session } = await supabase.auth.getSession();\n      const senderId = session?.session?.user?.id;\n      if (!senderId) throw new Error(\"Not authenticated.\");\n\n      const { data, error } = await supabase\n        .from(\"dm_messages\")\n        .insert([\n          {\n            sender_id: senderId,\n            message,\n            recipient_id: null, // admins see all\n          },\n        ])\n        .select();\n\n      if (error) throw error;\n\n      setMessages((prev) => [...prev, data[0]]);\n      setMessage(\"\");\n      setAttachments([]);\n    } catch (err: any) {\n      console.error(\"‚ùå Send failed:\", err.message);\n      alert(err.message);\n    } finally {\n      setSending(false);\n    }\n  };\n\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        height: \"100vh\",\n        background: \"#f9fafb\",\n        color: \"#111827\",\n      }}\n    >\n      {/* Chat Scroll Area */}\n      <div\n        style={{\n          flexGrow: 1,\n          overflowY: \"auto\",\n          padding: \"20px\",\n          paddingBottom: \"100px\",\n        }}\n      >\n        {messages.map((msg) => {\n          const isOutbound = msg.sender_id === currentUserId;\n          return (\n            <div\n              key={msg.id}\n              style={{\n                display: \"flex\",\n                justifyContent: isOutbound ? \"flex-end\" : \"flex-start\",\n                marginBottom: \"10px\",\n              }}\n            >\n              <div\n                style={{\n                  background: isOutbound ? \"#00838F\" : \"#E2E8F0\",\n                  color: isOutbound ? \"white\" : \"#1E293B\",\n                  borderRadius: \"12px\",\n                  padding: \"10px 14px\",\n                  maxWidth: \"70%\",\n                  wordBreak: \"break-word\",\n                }}\n              >\n                <div style={{ fontSize: \"14px\" }}>{msg.message}</div>\n                <div\n                  style={{\n                    fontSize: \"11px\",\n                    marginTop: \"4px\",\n                    opacity: 0.6,\n                    textAlign: isOutbound ? \"right\" : \"left\",\n                  }}\n                >\n                  {new Date(msg.created_at).toLocaleTimeString([], {\n                    hour: \"2-digit\",\n                    minute: \"2-digit\",\n                  })}\n                </div>\n              </div>\n            </div>\n          );\n        })}\n        <div ref={chatEndRef} />\n      </div>\n\n      {/* Sticky Footer Composer */}\n      <div\n        style={{\n          position: \"sticky\",\n          bottom: 0,\n          left: 0,\n          right: 0,\n          background: \"#fff\",\n          borderTop: \"1px solid #e5e7eb\",\n          padding: \"12px 20px\",\n          display: \"flex\",\n          alignItems: \"center\",\n          gap: \"10px\",\n        }}\n      >\n        <button\n          onClick={() => fileInputRef.current?.click()}\n          style={{\n            background: \"none\",\n            border: \"none\",\n            color: \"#0369a1\",\n            cursor: \"pointer\",\n          }}\n        >\n          <FiPaperclip size={18} />\n        </button>\n\n        <input\n          type=\"file\"\n          ref={fileInputRef}\n          multiple\n          onChange={handleAttach}\n          style={{ display: \"none\" }}\n        />\n\n        <input\n          value={message}\n          onChange={(e) => setMessage(e.target.value)}\n          placeholder=\"Type your message...\"\n          style={{\n            flexGrow: 1,\n            borderRadius: \"8px\",\n            border: \"1px solid #d1d5db\",\n            padding: \"10px\",\n            fontSize: \"14px\",\n          }}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" && !e.shiftKey) {\n              e.preventDefault();\n              handleSend();\n            }\n          }}\n        />\n\n        <button\n          onClick={handleSend}\n          disabled={sending}\n          style={{\n            background: \"#00838F\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"8px\",\n            padding: \"10px 14px\",\n            fontWeight: 500,\n            cursor: \"pointer\",\n            opacity: sending ? 0.8 : 1,\n            display: \"flex\",\n            alignItems: \"center\",\n            gap: \"6px\",\n          }}\n        >\n          <FiSend size={18} />\n        </button>\n      </div>\n    </div>\n  );\n};\n","import React, { useMemo } from \"react\";\nimport { useLocation } from \"@reach/router\";\nimport { SendDirectMessage } from \"../../../../../componets/messaging/SendDirectMessage\";\n\n\nconst MessagePage: React.FC = () => {\n  const location = useLocation();\n\n  // Extract optional messageId from URL\n  const messageId = useMemo(() => {\n    const parts = (location?.pathname || \"\").replace(/\\/+$/, \"\").split(\"/\");\n    return parts[parts.length - 1] || undefined;\n  }, [location?.pathname]);\n\n  return <SendDirectMessage messageId={messageId} />;\n};\n\nexport default MessagePage;\n"],"names":["SendDirectMessage","message","setMessage","useState","messages","setMessages","attachments","setAttachments","sending","setSending","currentUserId","setCurrentUserId","fileInputRef","useRef","chatEndRef","useEffect","supabase","auth","getSession","then","_ref","data","uid","session","_data$session","user","_data$session$user","id","async","_session$session","error","from","select","or","order","ascending","fetchMessages","current","_chatEndRef$current","scrollIntoView","behavior","handleSend","trim","length","senderId","_session$session2","_session$session2$use","Error","insert","sender_id","recipient_id","prev","err","console","alert","React","style","display","flexDirection","height","background","color","flexGrow","overflowY","padding","paddingBottom","map","msg","isOutbound","key","justifyContent","marginBottom","borderRadius","maxWidth","wordBreak","fontSize","marginTop","opacity","textAlign","Date","created_at","toLocaleTimeString","hour","minute","ref","position","bottom","left","right","borderTop","alignItems","gap","onClick","_fileInputRef$current","click","border","cursor","FiPaperclip","size","type","multiple","onChange","e","target","files","newFiles","Array","value","placeholder","onKeyDown","shiftKey","preventDefault","disabled","fontWeight","FiSend","MessagePage","location","useLocation","messageId","useMemo","parts","pathname","replace","split","undefined"],"sourceRoot":""}