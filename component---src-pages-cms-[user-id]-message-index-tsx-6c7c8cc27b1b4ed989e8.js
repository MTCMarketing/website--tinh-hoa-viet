/*! For license information please see component---src-pages-cms-[user-id]-message-index-tsx-6c7c8cc27b1b4ed989e8.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3065],{856:function(e,t,n){var a=n(6540),r=n(5268),o=n(6898);const i={EN:{brandTitle:"TINH HOA VI·ªÜT",tagline:"Where Vietnamese Excellence Meets Global Recognition",loading:"Checking authentication...",redirect:"Redirecting..."},VN:{brandTitle:"TINH HOA VI·ªÜT",tagline:"N∆°i t√¥n vinh tinh hoa Vi·ªát Nam v∆∞∆°n t·∫ßm qu·ªëc t·∫ø",loading:"ƒêang ki·ªÉm tra x√°c th·ª±c...",redirect:"ƒêang chuy·ªÉn h∆∞·ªõng..."}};t.A=e=>{let{children:t,redirectTo:n="/sign-in",language:s="EN"}=e;const{0:l,1:c}=(0,a.useState)(null),{0:d,1:u}=(0,a.useState)(i[s].loading),{0:m,1:p}=(0,a.useState)(!0),g=i[s];return(0,a.useEffect)(()=>{(async()=>{const{data:e,error:t}=await o.ND.auth.getSession();if(t)return console.error("Session error:",t),u("‚ö†Ô∏è Error checking session."),void p(!1);e.session?(c(e.session),u("‚úÖ Access granted!")):(u("‚ùå You must be logged in to view this page."),setTimeout(()=>(0,r.navigate)(n),1800)),p(!1)})();const{data:e}=o.ND.auth.onAuthStateChange((e,t)=>{c(t),t||(u(g.redirect),setTimeout(()=>(0,r.navigate)(n),1500))});return()=>{e.subscription.unsubscribe()}},[n,g.redirect]),m||!l?a.createElement("div",{className:"auth-shell"},a.createElement("aside",{className:"brand-side","aria-hidden":!0},a.createElement("div",{className:"brand-sheen"}),a.createElement("div",{className:"brand-pattern"}),a.createElement("div",{className:"brand-wrap"},a.createElement("h1",{className:"brand-name"},g.brandTitle),a.createElement("p",{className:"brand-tag"},g.tagline))),a.createElement("main",{className:"form-side"},a.createElement("div",{className:"loading-block"},a.createElement("div",{className:"spinner"}),a.createElement("p",{className:"loading-text"},d)))):a.createElement(a.Fragment,null,t)}},964:function(e,t,n){n.d(t,{A:function(){return a}});const a=(0,n(9407).A)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},4539:function(e,t,n){n.d(t,{A:function(){return a}});const a=(0,n(9407).A)("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]])},5042:function(e,t,n){n.d(t,{A:function(){return a}});const a=(0,n(9407).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},7775:function(e,t,n){n.d(t,{A:function(){return a}});const a=(0,n(9407).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},8117:function(e,t,n){n.d(t,{A:function(){return a}});const a=(0,n(9407).A)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]])},8676:function(e,t,n){n.d(t,{A:function(){return a}});const a=(0,n(9407).A)("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]])},8697:function(e,t,n){n.d(t,{A:function(){return a}});const a=(0,n(9407).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9230:function(e,t,n){n.d(t,{A:function(){return a}});const a=(0,n(9407).A)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]])},9407:function(e,t,n){n.d(t,{A:function(){return c}});var a=n(6540);const r=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim(),i=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const l=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:l="",children:c,iconNode:d,...u},m)=>(0,a.createElement)("svg",{ref:m,...s,width:t,height:t,stroke:e,strokeWidth:r?24*Number(n)/Number(t):n,className:o("lucide",l),...!c&&!i(u)&&{"aria-hidden":"true"},...u},[...d.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(c)?c:[c]])),c=(e,t)=>{const n=(0,a.forwardRef)(({className:n,...i},s)=>{return(0,a.createElement)(l,{ref:s,iconNode:t,className:o(`lucide-${c=r(e),c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...i});var c});return n.displayName=r(e),n}},9510:function(e,t,n){n.r(t),n.d(t,{default:function(){return f}});var a=n(6540),r=n(856),o=n(5458),i=n(8697),s=n(9230),l=n(964),c=n(8676),d=n(4539),u=n(5042),m=n(8117),p=n(7775),g=n(6898);const h=e=>{let{userId:t}=e;const{0:n,1:r}=(0,a.useState)("light"),{0:h,1:f}=(0,a.useState)(!1),{0:b,1:v}=(0,a.useState)(!1),{0:k,1:x}=(0,a.useState)(""),{0:y,1:E}=(0,a.useState)([]),{0:w,1:N}=(0,a.useState)(!1),{0:A,1:S}=(0,a.useState)([]),{0:C,1:z}=(0,a.useState)(null),_=(0,a.useRef)(null),M=(0,a.useRef)(null),I=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async function(){var e,t,n;const{data:a,error:r}=await g.ND.auth.getSession();r&&console.error("‚ö†Ô∏è getSession error:",r.message);const o=null!==(e=null===(t=a.session)||void 0===t||null===(n=t.user)||void 0===n?void 0:n.id)&&void 0!==e?e:null;return console.log("üë§ Current User ID:",o),o})().then(z)},[]),(0,a.useEffect)(()=>{t&&(async()=>{try{console.log("üîç Pulling messages from:",t);const e=await async function(e){var t,n,a,r;const{data:o}=await g.ND.auth.getSession(),i=null!==(t=null==o||null===(n=o.session)||void 0===n||null===(a=n.user)||void 0===a?void 0:a.id)&&void 0!==t?t:null;console.log("üì¶ Fetching messages | acting as:",i,"| target:",e);const{data:s,error:l}=await g.ND.from("dm_messages").select("*").or("sender_id.eq."+e+",recipient_id.eq."+e).order("created_at",{ascending:!0});if(l)throw l;return console.log("‚úÖ Loaded "+(null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0)+" messages"),s}(t);console.log("‚úÖ "+e.length+" rows returned",e),S(e)}catch(e){console.error("‚ùå Fetch failed:",e.message)}})()},[t]),(0,a.useEffect)(()=>{if(!C)return;if(!t)return;let e;return(async()=>{e=await async function(e,t){return console.log("üëÇ Subscribing to realtime messages involving:",e),g.ND.channel("dm_messages_"+e).on("postgres_changes",{event:"INSERT",schema:"public",table:"dm_messages",filter:"sender_id=eq."+e},e=>{console.log("üì® Realtime (as sender):",e.new),t(e.new)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"dm_messages",filter:"recipient_id=eq."+e},e=>{console.log("üì© Realtime (as recipient):",e.new),t(e.new)}).subscribe(e=>console.log("üì° Channel status:",e))}(t,e=>{S(t=>t.some(t=>t.id===e.id)?t:[].concat((0,o.A)(t),[e]))})})(),()=>{e&&(console.log("üßπ Unsubscribing from dm_messages channel"),g.ND.removeChannel(e))}},[C,t]),(0,a.useEffect)(()=>{var e;null===(e=I.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[A]);const T=async()=>{if((k.trim()||0!==y.length)&&C){N(!0);try{const e=await async function(e,t,n){console.log("üöÄ Sending message...",{senderId:e,recipientId:n,message:t});const{data:a,error:r}=await g.ND.from("dm_messages").insert([{sender_id:e,message:t,recipient_id:n}]).select();if(r)throw console.error("üî• Supabase insert error:",r),r;return console.log("‚úÖ Message sent:",a),a}(C,k,null!=t?t:null);e&&e[0]&&(S(t=>[].concat((0,o.A)(t),[e[0]])),x(""),E([]))}catch(e){alert("‚ùå Send failed: "+e.message)}finally{N(!1)}}};return(0,a.useEffect)(()=>{const e=e=>{_.current&&!_.current.contains(e.target)&&f(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),a.createElement("div",{className:"app "+n},a.createElement("style",null,"\n        body, html { margin: 0; font-family: 'Inter', sans-serif; }\n        .app { min-height: 100vh; background: var(--bg); color: var(--text);\n          transition: background .3s, color .3s; display: flex; flex-direction: column; }\n        .app.light { --bg: #f8fafc; --panel: #ffffff; --border: rgba(0,0,0,0.08);\n          --text: #111827; --muted: #6b7280; --accent: #10b981; --accent-bg: rgba(16,185,129,0.1);}\n        .app.dark { --bg: #0f1318; --panel: #0b0f14; --border: rgba(255,255,255,0.08);\n          --text: #d1d5db; --muted: #9ca3af; --accent: #10b981; --accent-bg: rgba(16,185,129,0.15);}\n        header { background: var(--panel); border-bottom: 1px solid var(--border);\n          padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 30;}\n        .brand { display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--text); font-size: 14px;}\n        .brand-icon { width: 24px; height: 24px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 3px;}\n        .actions { display: flex; align-items: center; gap: 10px;}\n        button { border: none; border-radius: 5px; font-size: 13px; padding: 7px 12px; cursor: pointer;\n          background: var(--panel); color: var(--text); display: flex; align-items: center; gap: 6px; transition: all .2s;}\n        button:hover { background: var(--accent-bg); }\n        .primary-btn { background: var(--accent); color: #072c21; font-weight: 500;}\n        .chat-area { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }\n       .chat-row {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n/* every bubble sits on its own row */\n.chat-bubble {\n  display: block;            /* <‚Äî force new line */\n  width: fit-content;        /* shrink to message text */\n  max-width: 300px;          /* cap the width */\n  border-radius: 12px;\n  padding: 10px 14px;\n  word-break: break-word;\n  line-height: 1.4;\n  margin-bottom: 10px;\n}\n\n.outbound {\n  background: var(--accent);\n  color: #072c21;\n  margin-left: auto;         /* right aligned */\n  border-top-right-radius: 6px;\n}\n\n.inbound {\n  background: var(--panel);\n  border: 1px solid var(--border);\n  color: var(--text);\n  margin-right: auto;        /* left aligned */\n  border-top-left-radius: 6px;\n}\n\n        .timestamp { font-size: 11px; opacity: 0.6; margin-top: 4px; text-align: right; }\n        .sticky-footer { position: sticky; bottom: 0; background: var(--panel); border-top: 1px solid var(--border);\n          padding: 12px 20px; display: flex; align-items: center; gap: 10px; }\n        input.msg-input { flex-grow: 1; border-radius: 8px; border: 1px solid var(--border);\n          background: var(--panel); color: var(--text); padding: 10px; font-size: 14px; }\n        footer { text-align: center; color: var(--muted); font-size: 12px; margin: 20px 0; }\n        .dropdown { position: relative;}\n        .menu { position: absolute; top: 110%; right: 0; background: var(--panel); border: 1px solid var(--border);\n          border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); width: 160px; overflow: hidden; z-index: 50; display: none;}\n        .menu.open { display: block; }\n      "),a.createElement("header",null,a.createElement("div",{className:"brand"},a.createElement("button",{onClick:()=>v(!b),style:{background:"none",border:"none",cursor:"pointer"}},b?a.createElement(i.A,{size:18}):a.createElement(s.A,{size:18})),a.createElement("div",{className:"brand-icon"}),"Admin Messages"),a.createElement("div",{className:"actions"},a.createElement("div",{className:"dropdown",ref:_},a.createElement("button",{onClick:()=>f(!h)},a.createElement(l.A,{size:14})," Settings"),a.createElement("div",{className:"menu "+(h?"open":"")},a.createElement("button",{onClick:()=>alert("Profile clicked")},"Profile"),a.createElement("button",{onClick:()=>alert("Preferences clicked")},"Preferences"),a.createElement("hr",null),a.createElement("button",{onClick:()=>r("light"===n?"dark":"light")},"light"===n?a.createElement(c.A,{size:14}):a.createElement(d.A,{size:14})," Theme:"," ","light"===n?"Dark":"Light"))),a.createElement("button",{className:"primary-btn"},a.createElement(u.A,{size:14})," Sign out"))),a.createElement("div",{className:"chat-area"},A.map(e=>{const t=e.sender_id===C;return a.createElement("div",{key:e.id,className:"chat-bubble "+(t?"outbound":"inbound")},a.createElement("div",null,e.message),a.createElement("div",{className:"timestamp"},new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})))}),a.createElement("div",{ref:I})),a.createElement("div",{className:"sticky-footer"},a.createElement("button",{onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},style:{background:"none",border:"none",color:"var(--accent)",cursor:"pointer"}},a.createElement(m.A,{size:18})),a.createElement("input",{type:"file",ref:M,multiple:!0,onChange:e=>{if(e.target.files){const t=Array.from(e.target.files);E(e=>[].concat((0,o.A)(e),t))}},style:{display:"none"}}),a.createElement("input",{value:k,onChange:e=>x(e.target.value),placeholder:"Type your message...",className:"msg-input",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())}}),a.createElement("button",{onClick:T,disabled:w,style:{background:"var(--accent)",color:"#072c21",borderRadius:"8px",padding:"10px 14px",fontWeight:500,cursor:"pointer",opacity:w?.8:1,display:"flex",alignItems:"center",gap:"6px"}},a.createElement(p.A,{size:18}))))};var f=()=>{const e="undefined"==typeof window||void 0===window.location?null:window.location,t=(0,a.useMemo)(()=>{if(null==e||!e.pathname)return null;const t=e.pathname.split("/");return t[t.length-1]||null},[null==e?void 0:e.pathname]);return a.createElement(r.A,null,t?a.createElement(h,{userId:t}):a.createElement("div",{style:{padding:40,textAlign:"center"}},"‚ö†Ô∏è Invalid or missing user ID"))}}}]);
//# sourceMappingURL=component---src-pages-cms-[user-id]-message-index-tsx-6c7c8cc27b1b4ed989e8.js.map