"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7836],{2259:function(e,t,r){r.r(t);var n=r(6540),l=r(6898);const s="02c567a2-b193-4009-89e5-884386540733",a="6c77d859-1af1-418e-b0e0-0d3cc4e80fad",o="d3ca3641-e106-4a4d-a288-bb3e0c4e3a9a";t.default=()=>{const{0:e,1:t}=(0,n.useState)(null),{0:r,1:u}=(0,n.useState)("(no session)"),{0:c,1:i}=(0,n.useState)("unauthenticated"),{0:d,1:m}=(0,n.useState)({}),{0:f,1:g}=(0,n.useState)({}),{0:h,1:E}=(0,n.useState)(!0),{0:b,1:p}=(0,n.useState)(null);return(0,n.useEffect)(()=>{(async()=>{try{var r,n;E(!0);const{data:d}=await l.ND.auth.getSession(),f=null!==(r=null==d||null===(n=d.session)||void 0===n?void 0:n.user)&&void 0!==r?r:null;if(f){t(f.id),u(f.email||"(session user)");const{data:e,error:r}=await l.ND.from("user_roles").select("role").eq("id",f.id).maybeSingle();r&&console.warn("role lookup error:",r.message);const n=(null==e?void 0:e.role)||"none";i(n)}else t(null),u("(no session)"),i("unauthenticated");const h={},b={},p=[["(1) Member 1 row",{user_id:s}],["(2) Admin row",{user_id:a}],["(3) Member 2 row",{user_id:o}],["(4) Select all",{}]];for(const[e,t]of p){let r=l.ND.from("user_credentials").select("*");for(const[e,l]of Object.entries(t))r=r.eq(e,l);const{data:n,error:s}=await r;s&&console.warn("SELECT "+e+" error:",s.message),h[e]=n||[],b[e]=n&&n.length?"‚úÖ "+n.length+" row(s) visible":"‚ö†Ô∏è No rows (RLS restricted)"}for(const[t,r]of Object.entries(h)){if(null==r||!r.length)continue;const n=[];let s=0,a=0,o=!1;for(const t of r){const r=(t.rank||"Rank")+"_"+Math.floor(100*Math.random()),{error:u}=await l.ND.from("user_credentials").update({rank:r}).eq("user_id",t.user_id);u?(n.push({user_id:t.user_id,error:u.message}),a++):(n.push({user_id:t.user_id,updated_rank:r}),s++,"member"===c&&e&&t.user_id!==e&&(o=!0))}let u="";u="admin"===c?s?"‚úÖ "+s+" success (admin allowed)":"‚ö†Ô∏è "+a+" failed (unexpected for admin)":"member"===c?o?"‚ùå "+s+" success (should be read-only / own-row only)":s>0?"‚ùå "+s+" success (members should be read-only)":"‚úÖ "+a+" failed (expected read-only for members)":s?"‚ùå "+s+" success (should fail unauthenticated)":"‚úÖ "+a+" failed (expected unauthenticated)",h["UPDATE TEST for "+t]=n,b["UPDATE TEST for "+t]=u}m(h),g(b)}catch(d){console.error(d),p(d.message)}finally{E(!1)}})()},[]),n.createElement("div",{style:{width:"100%",minHeight:"100vh",background:"#fff"}},n.createElement("main",{style:{fontFamily:"sans-serif",padding:"2rem"}},n.createElement("h1",null,"üß© Supabase Role Access Test ‚Äî user_credentials"),h?n.createElement("p",null,"Loading..."):b?n.createElement("p",{style:{color:"red"}},"Error: ",b):n.createElement(n.Fragment,null,n.createElement("p",null,n.createElement("strong",null,"Logged in as:")," ",r),n.createElement("p",null,n.createElement("strong",null,"UID:")," ",e),n.createElement("p",null,n.createElement("strong",null,"Role (via user_roles):")," ",c),n.createElement("hr",null),Object.entries(d).map(e=>{var t,r;let[l,s]=e;return n.createElement("section",{key:l,style:{marginBottom:"2rem"}},n.createElement("h3",null,l),n.createElement("p",{style:{fontWeight:"bold",color:null!==(t=f[l])&&void 0!==t&&t.includes("‚ùå")?"red":null!==(r=f[l])&&void 0!==r&&r.includes("‚ö†Ô∏è")?"orange":"green"}},f[l]),0===s.length?n.createElement("p",{style:{color:"#999"}},"No rows visible (RLS restricted)"):n.createElement("pre",{style:{background:"#f8f8f8",padding:"1rem",borderRadius:"8px",overflowX:"auto"}},JSON.stringify(s,null,2)))}))))}}}]);
//# sourceMappingURL=component---src-pages-test-role-v-2-creds-tsx-a4add81e9b7e0dda7887.js.map