{"version":3,"file":"component---src-pages-test-role-based-routes-tsx-f4a29312fd0aff344dfc.js","mappings":"4HAyIA,IA/E8CA,IAIvC,IAJwC,SAC7CC,EAAQ,KACRC,EAAO,SAAQ,SACfC,EAAW,sBACZ,EACC,MAAM,EAACC,EAAQ,EAACC,IAAcC,EAAAA,EAAAA,UAAc,OACtC,EAACC,EAAS,EAACC,IAAeF,EAAAA,EAAAA,UAAwB,OAClD,EAACG,EAAQ,EAACC,IAAcJ,EAAAA,EAAAA,WAAS,IACjC,EAACK,EAAQ,EAACC,IAAcN,EAAAA,EAAAA,WAAS,IAEvCO,EAAAA,EAAAA,WAAU,KACYC,WAClBJ,GAAW,GACX,IAAK,IAAD,IACF,MAAM,KAAEK,SAAeC,EAAAA,GAASC,KAAKC,aAC/BC,EAAOJ,EAAKX,QAIlB,GAHAC,EAAWc,GAGNA,UAAAA,EAAMC,KAIT,OAHAC,EAAAA,EAAAA,UAAS,YACTT,GAAW,QACXJ,EAAY,MAKd,MAAMc,EAAiC,QAAhC,EAA0B,QAA1B,EAAGH,EAAKC,KAAKG,qBAAa,aAAvBC,EAAyBtB,YAAI,QAAI,SAI3C,GAHAM,EAAYc,GAGQ,iBAATpB,EACTU,EAAWU,IAAMpB,GAAkB,WAATA,KAAuBoB,OAC5C,CACL,MAAMG,EAAOvB,EAAKoB,GAClBV,IAAaa,EACf,CACF,CAAE,MAAOC,GACPC,QAAQC,MAAM,0BAA2BF,GACzCd,GAAW,EACb,CAAC,QACCF,GAAW,EACb,GAGFmB,IACC,CAAC3B,IAEJ,MAAM4B,EAAc,CAAEnB,UAASF,UAASL,UAASF,KAAMK,GAGvD,MAAwB,mBAAbN,EACF8B,EAAAA,cAAAA,EAAAA,SAAAA,KAAI9B,EAAiB6B,MAI9BjB,EAAAA,EAAAA,WAAU,KACR,IAAIJ,GAAYF,EAEhB,GAAoB,iBAATL,EACJS,IAASU,EAAAA,EAAAA,UAASlB,OAClB,CACL,MAAMsB,EAAOvB,EAAKK,GACbkB,GAEOd,GAAWc,EAAKO,SAC1BX,EAAAA,EAAAA,UAASI,EAAKO,SACLrB,GAAWc,EAAKQ,SACzBZ,EAAAA,EAAAA,UAASI,EAAKQ,SAJdZ,EAAAA,EAAAA,UAASlB,EAMb,GACC,CAACM,EAASE,EAASJ,EAAUL,EAAMC,IAElCM,EAAgB,KACfE,GAA2B,iBAATT,EAEhB6B,EAAAA,cAAAA,EAAAA,SAAAA,KAAG9B,GAFuC,M,sGC5HnD,SAASiC,IACP,MAAOC,EAAMC,GAAWL,EAAAA,SAAoB,MAwB5C,OAtBAA,EAAAA,UAAgB,KACd,OAACjB,IACC,MAAM,KAAEC,SAAeC,EAAAA,GAASC,KAAKC,aAC/Bd,EAAUW,EAAKX,QACrB,IAAKA,EAEH,YADAgC,EAAQ,qBAGV,MAAQrB,KAAMsB,SAAkBrB,EAAAA,GAC7BsB,KAAK,gBACLC,OAAO,QACPC,GAAG,KAAMpC,EAAQgB,KAAKqB,IACtBC,SAEHN,EAAQ,CACNO,MAAOvC,EAAQgB,KAAKuB,MACpBF,GAAIrC,EAAQgB,KAAKqB,GACjBvC,KAAmB,QAAf,EAAEmC,aAAO,EAAPA,EAASnC,YAAI,QAAI,UAE1B,EAlBD,IAmBC,IAGD6B,EAAAA,cAAAA,MAAAA,CACEa,MAAO,CACLC,WAAY,OACZC,MAAO,OACPC,QAAS,GACTC,aAAc,EACdC,WAAY,YACZC,UAAW,KAGbnB,EAAAA,cAAAA,SAAAA,KAAQ,iBACRA,EAAAA,cAAAA,MAAAA,CAAKa,MAAO,CAAEO,WAAY,WAAYC,SAAU,KAC7CC,KAAKC,UAAUnB,EAAM,KAAM,IAIpC,CAKe,SAASoB,IACtB,MAAMC,EAAcA,CAACC,EAAmBX,EAAeY,IAAsB1D,IAAA,IAAC,QAC5ES,EAAO,QACPE,EAAO,KACPT,GAKD,SACC6B,EAAAA,cAAAA,MAAAA,CACEa,MAAO,CACLC,WAAYlC,EACRmC,EACArC,EACA,UACA,UACJsC,QAAS,GACTC,aAAc,EACdF,MAAOnC,EACH+C,EACAjD,EACA,UACA,UACJkD,OAAQhD,EAAO,aACE+C,EACbjD,EACA,oBACA,iBACJmD,WAAY,OACZC,WAAY,kBAGbpD,EACG,uBACAE,EAAO,4DACqDT,EAAI,2CAC5BA,QAAAA,EAAQ,QAAM,OAI1D,OACE6B,EAAAA,cAAAA,MAAAA,CACEa,MAAO,CACLC,WAAY,OACZC,MAAO,OACPgB,UAAW,QACXb,WAAY,wBACZF,QAAS,KAGXhB,EAAAA,cAAAA,KAAAA,KAAI,kCACJA,EAAAA,cAAAA,IAAAA,CAAGa,MAAO,CAAEmB,aAAc,KAAM,wBACT,4BAAO,gBAAsB,wIAMpDhC,EAAAA,cAAAA,UAAAA,CACEa,MAAO,CACLe,OAAQ,iBACRZ,QAAS,GACTC,aAAc,EACde,aAAc,KAGhBhC,EAAAA,cAAAA,KAAAA,KAAI,kBACJA,EAAAA,cAACiC,EAAAA,EAAU,CAAC9D,KAAK,UACdsD,EAAY,EAAW,UAAW,aAKvCzB,EAAAA,cAAAA,UAAAA,CACEa,MAAO,CACLe,OAAQ,iBACRZ,QAAS,GACTC,aAAc,EACde,aAAc,KAGhBhC,EAAAA,cAAAA,KAAAA,KAAI,kBACJA,EAAAA,cAACiC,EAAAA,EAAU,CAAC9D,KAAK,SACdsD,EAAY,EAAS,UAAW,aAKrCzB,EAAAA,cAAAA,UAAAA,CACEa,MAAO,CACLe,OAAQ,iBACRZ,QAAS,GACTC,aAAc,IAGhBjB,EAAAA,cAAAA,KAAAA,KAAI,yBACJA,EAAAA,cAACiC,EAAAA,EAAU,CAAC9D,KAAK,iBACdsD,EAAY,EAAiB,UAAW,aAI7CzB,EAAAA,cAACG,EAAW,MAEZH,EAAAA,cAAAA,MAAAA,CACEa,MAAO,CACLM,UAAW,GACXH,QAAS,GACTkB,UAAW,iBACXnB,MAAO,OACPM,SAAU,KAGZrB,EAAAA,cAAAA,KAAAA,KAAI,0BACJA,EAAAA,cAAAA,IAAAA,KAAG,gCAC4B,4BAAO,gBAAsB,4CAG5DA,EAAAA,cAAAA,KAAAA,CAAIa,MAAO,CAAEM,UAAW,IACtBnB,EAAAA,cAAAA,KAAAA,KAAI,gCACJA,EAAAA,cAAAA,KAAAA,KAAI,6BACJA,EAAAA,cAAAA,KAAAA,KAAI,mCAKd,C","sources":["webpack:///./src/componets/shared/ProtectedRoute/RoleRoutes.tsx","webpack:///./src/pages/test/role-based-routes.tsx"],"sourcesContent":["/**\n * üîê RoleRoutes ‚Äî Universal role-based route guard\n *\n * Supports two input styles:\n * \n * ‚ë† Simple string role (default)\n *    --------------------------------------------\n *    <RoleRoutes role=\"admin\">\n *      <AdminDashboard />\n *    </RoleRoutes>\n *\n *    ‚Ä¢ Only users whose role === \"admin\" can view.\n *    ‚Ä¢ Unauthenticated users ‚Üí redirected to /sign-in\n *    ‚Ä¢ Others ‚Üí redirected to `redirect` (default: /members/dashboard)\n *\n * \n * ‚ë° Advanced role object with onTrue/onFalse routes\n *    --------------------------------------------\n *    <RoleRoutes\n *      role={{\n *        admin:  { onTrue: \"/admin/home\" },\n *        member: { onFalse: \"/access-denied\" },\n *      }}\n *    >\n *      <ProtectedPage />\n *    </RoleRoutes>\n *\n *    ‚Ä¢ `onTrue`  ‚Üí redirect if user *is* that role.\n *    ‚Ä¢ `onFalse` ‚Üí redirect if user *is not* that role.\n *    ‚Ä¢ Unauthenticated ‚Üí /sign-in.\n *    ‚Ä¢ If no mapping exists ‚Üí fallback redirect used.\n */\n\nimport React, { useEffect, useState } from \"react\";\nimport { supabase } from \"../../../database/supabaseClient\";\nimport { navigate } from \"gatsby\";\n\ninterface RoleRoutesProps {\n  children:\n    | React.ReactNode\n    | ((info: {\n        allowed: boolean;\n        loading: boolean;\n        session: any;\n        role: string | null;\n      }) => React.ReactNode);\n  role?:\n    | string\n    | Record<\n        string,\n        {\n          onTrue?: string;\n          onFalse?: string;\n        }\n      >;\n  redirect?: string;\n}\n\nconst RoleRoutes: React.FC<RoleRoutesProps> = ({\n  children,\n  role = \"member\",\n  redirect = \"/members/dashboard\",\n}) => {\n  const [session, setSession] = useState<any>(null);\n  const [userRole, setUserRole] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [allowed, setAllowed] = useState(false);\n\n  useEffect(() => {\n    const checkAccess = async () => {\n      setLoading(true);\n      try {\n        const { data } = await supabase.auth.getSession();\n        const sess = data.session;\n        setSession(sess);\n\n        // (1) Not authenticated ‚Üí send to sign-in\n        if (!sess?.user) {\n          navigate(\"/sign-in\");\n          setAllowed(false);\n          setUserRole(null);\n          return;\n        }\n\n        // (2) Extract role\n        const r = sess.user.user_metadata?.role ?? \"member\";\n        setUserRole(r);\n\n        // (3) Determine access\n        if (typeof role === \"string\") {\n          setAllowed(r === role || (role === \"member\" && !!r));\n        } else {\n          const rule = role[r];\n          setAllowed(!!rule);\n        }\n      } catch (err) {\n        console.error(\"RoleRoutes check error:\", err);\n        setAllowed(false);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    checkAccess();\n  }, [role]);\n\n  const renderProps = { allowed, loading, session, role: userRole };\n\n  // Render-function support\n  if (typeof children === \"function\") {\n    return <>{(children as any)(renderProps)}</>;\n  }\n\n  // Redirect behavior\n  useEffect(() => {\n    if (loading || !userRole) return;\n\n    if (typeof role === \"string\") {\n      if (!allowed) navigate(redirect);\n    } else {\n      const rule = role[userRole];\n      if (!rule) {\n        navigate(redirect);\n      } else if (!allowed && rule.onFalse) {\n        navigate(rule.onFalse);\n      } else if (allowed && rule.onTrue) {\n        navigate(rule.onTrue);\n      }\n    }\n  }, [loading, allowed, userRole, role, redirect]);\n\n  if (loading) return null;\n  if (!allowed && typeof role === \"string\") return null;\n\n  return <>{children}</>;\n};\n\nexport default RoleRoutes;\n","\"use client\";\nimport React from \"react\";\nimport { supabase } from \"../../database/supabaseClient\";\nimport RoleRoutes from \"../../componets/shared/ProtectedRoute/RoleRoutes\";\n\n/**\n * Small helper to print session + role for verification\n */\nfunction SessionInfo() {\n  const [info, setInfo] = React.useState<any>(null);\n\n  React.useEffect(() => {\n    (async () => {\n      const { data } = await supabase.auth.getSession();\n      const session = data.session;\n      if (!session) {\n        setInfo(\"No active session\");\n        return;\n      }\n      const { data: roleRow } = await supabase\n        .from(\"user_private\")\n        .select(\"role\")\n        .eq(\"id\", session.user.id)\n        .single();\n\n      setInfo({\n        email: session.user.email,\n        id: session.user.id,\n        role: roleRow?.role ?? \"(none)\",\n      });\n    })();\n  }, []);\n\n  return (\n    <div\n      style={{\n        background: \"#111\",\n        color: \"#0f0\",\n        padding: 12,\n        borderRadius: 6,\n        fontFamily: \"monospace\",\n        marginTop: 20,\n      }}\n    >\n      <strong>SESSION DEBUG</strong>\n      <pre style={{ whiteSpace: \"pre-wrap\", fontSize: 12 }}>\n        {JSON.stringify(info, null, 2)}\n      </pre>\n    </div>\n  );\n}\n\n/**\n * üîí Test page for verifying RoleRoutes behavior (logical version)\n */\nexport default function TestRoleRoutes() {\n  const renderBlock = (roleLabel: string, color: string, textColor: string) => ({\n    loading,\n    allowed,\n    role,\n  }: {\n    loading: boolean;\n    allowed: boolean;\n    role: string | null;\n  }) => (\n    <div\n      style={{\n        background: allowed\n          ? color\n          : loading\n          ? \"#fffad6\"\n          : \"#ffe7e7\",\n        padding: 20,\n        borderRadius: 8,\n        color: allowed\n          ? textColor\n          : loading\n          ? \"#aa7700\"\n          : \"#880000\",\n        border: allowed\n          ? `2px solid ${textColor}`\n          : loading\n          ? \"2px solid #cca300\"\n          : \"2px solid #f33\",\n        fontWeight: \"bold\",\n        transition: \"all 0.3s ease\",\n      }}\n    >\n      {loading\n        ? \"‚è≥ Checking access...\"\n        : allowed\n        ? `‚úÖ You‚Äôre allowed to see this because your role matches (‚Äú${role}‚Äù).`\n        : `‚ùå Access denied ‚Äî current role: ‚Äú${role ?? \"none\"}‚Äù.`}\n    </div>\n  );\n\n  return (\n    <div\n      style={{\n        background: \"#fff\",\n        color: \"#000\",\n        minHeight: \"100vh\",\n        fontFamily: \"system-ui, sans-serif\",\n        padding: 20,\n      }}\n    >\n      <h1>üß© RoleRoutes Integration Test</h1>\n      <p style={{ marginBottom: 20 }}>\n        This page mounts the <code>{\"<RoleRoutes>\"}</code> component directly.\n        It will fetch your Supabase session, determine your role, and show the\n        correct access state for each role test.\n      </p>\n\n      {/* ---- MEMBER TEST ---- */}\n      <section\n        style={{\n          border: \"2px solid #ccc\",\n          padding: 16,\n          borderRadius: 8,\n          marginBottom: 30,\n        }}\n      >\n        <h2>üë§ Member Test</h2>\n        <RoleRoutes role=\"member\">\n          {renderBlock(\"#e7ffe7\", \"#e7ffe7\", \"#005500\")}\n        </RoleRoutes>\n      </section>\n\n      {/* ---- ADMIN TEST ---- */}\n      <section\n        style={{\n          border: \"2px solid #ccc\",\n          padding: 16,\n          borderRadius: 8,\n          marginBottom: 30,\n        }}\n      >\n        <h2>üõ°Ô∏è Admin Test</h2>\n        <RoleRoutes role=\"admin\">\n          {renderBlock(\"admin\", \"#ffe7e7\", \"#880000\")}\n        </RoleRoutes>\n      </section>\n\n      {/* ---- AUTHENTICATOR TEST ---- */}\n      <section\n        style={{\n          border: \"2px solid #ccc\",\n          padding: 16,\n          borderRadius: 8,\n        }}\n      >\n        <h2>ü™™ Authenticator Test</h2>\n        <RoleRoutes role=\"authenticator\">\n          {renderBlock(\"authenticator\", \"#e7f0ff\", \"#004488\")}\n        </RoleRoutes>\n      </section>\n\n      <SessionInfo />\n\n      <div\n        style={{\n          marginTop: 40,\n          padding: 16,\n          borderTop: \"1px solid #ddd\",\n          color: \"#444\",\n          fontSize: 14,\n        }}\n      >\n        <h3>‚ÑπÔ∏è How this test works</h3>\n        <p>\n          Each section mounts the real <code>{\"<RoleRoutes>\"}</code> wrapper\n          with a different required role.\n        </p>\n        <ul style={{ marginTop: 6 }}>\n          <li>‚úÖ Green box ‚Üí access granted</li>\n          <li>‚ùå Red box ‚Üí access denied</li>\n          <li>‚è≥ Yellow box ‚Üí still checking</li>\n        </ul>\n      </div>\n    </div>\n  );\n}\n"],"names":["_ref","children","role","redirect","session","setSession","useState","userRole","setUserRole","loading","setLoading","allowed","setAllowed","useEffect","async","data","supabase","auth","getSession","sess","user","navigate","r","user_metadata","_sess$user$user_metad2","rule","err","console","error","checkAccess","renderProps","React","onFalse","onTrue","SessionInfo","info","setInfo","roleRow","from","select","eq","id","single","email","style","background","color","padding","borderRadius","fontFamily","marginTop","whiteSpace","fontSize","JSON","stringify","TestRoleRoutes","renderBlock","roleLabel","textColor","border","fontWeight","transition","minHeight","marginBottom","RoleRoutes","borderTop"],"sourceRoot":""}