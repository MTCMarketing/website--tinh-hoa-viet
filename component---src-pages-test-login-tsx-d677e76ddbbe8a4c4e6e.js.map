{"version":3,"file":"component---src-pages-test-login-tsx-d677e76ddbbe8a4c4e6e.js","mappings":"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","sources":["webpack:///./src/database/functions.ts","webpack:///./src/pages/test/login.tsx","webpack:///./src/database/session-repair.ts"],"sourcesContent":["import { clearStaleSupabaseKeys } from \"./session-repair\";\nimport { supabase } from \"./supabaseClient\";\n\n\n\n\n\n\nexport const handleLogout = async ({ onSuccess, onFail } = {}) => {\n  console.log(\"üîê Logging out‚Ä¶\");\n\n  // Remove corrupted keys ONLY\n  clearStaleSupabaseKeys();\n\n  // Call Supabase logout\n  const { error } = await supabase.auth.signOut();\n\n  if (error) {\n    console.error(\"‚ùå Logout error:\", error);\n    return onFail?.(error.message);\n  }\n\n  // Clear *all* session keys (safe now)\n  clearStaleSupabaseKeys();\n\n  // Optionally wipe saved session map\n  localStorage.removeItem(\"__thv_valid_supabase_keys__\");\n\n  onSuccess?.();\n};\n\n\n\n\n\nexport const handleSignup = async ({\n  email,\n  password,\n  fullName,\n  onSuccess,\n  onFail,\n}: {\n  email: string\n  password: string\n  fullName?: string\n  onSuccess?: () => void\n  onFail?: (error?: string) => void\n}) => {\n  const { data, error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      data: {\n        full_name: fullName || \"unknown\",\n        signup_source: \"thv-web\", // optional\n      },\n    },\n  })\n\n  if (error) onFail?.(error.message)\n  else onSuccess?.()\n}\n\n\nexport const handleLogin = async (\n  { email, password, onSuccess, onFail }: {\n    email: string\n    password: string\n    onSuccess?: () => void\n    onFail?: (error?: string) => void\n  }\n) => {\n  const { data, error } = await supabase.auth.signInWithPassword({ email, password })\n  if (error) onFail?.(error.message)\n  else onSuccess?.()\n}\n\nexport const handleResetPassword = async (\n  { email, onSuccess, onFail }: {\n    email: string\n    onSuccess?: () => void\n    onFail?: (error?: string) => void\n  }\n) => {\n  const { data, error } = await supabase.auth.resetPasswordForEmail(email)\n  if (error) onFail?.(error.message)\n  else onSuccess?.()\n}\n\nexport const handleUpdatePassword = async (\n  { newPassword, onSuccess, onFail }: {\n    newPassword: string\n    onSuccess?: () => void\n    onFail?: (error?: string) => void\n  }\n) => {\n  const { data, error } = await supabase.auth.updateUser({ password: newPassword })\n  if (error) onFail?.(error.message)\n  else onSuccess?.()\n}\n\n\n\nexport interface UpdateUserData {\n  fullName?: string;\n  phone?: string;\n  email?: string;\n  dob?: string;\n  address?: string;\n  hometown?: string;\n  field?: string;\n  goals?: string;\n  vision?: string;\n  status?: string;\n  avatar?: string;\n}\n\n/**\n * Updates user profile data across both tables: user_member & user_private\n * Automatically maps field names to Supabase column names.\n */\nexport const updateUserProfile = async (updates: UpdateUserData) => {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) throw new Error('Not logged in');\n\n    const memberPayload: any = {};\n    const privatePayload: any = {};\n\n    if (updates.fullName) memberPayload.full_name = updates.fullName;\n    if (updates.hometown) memberPayload.hometown = updates.hometown;\n    if (updates.field) memberPayload.field_of_expertise = updates.field;\n    if (updates.status) memberPayload.profile_status = updates.status;\n    if (updates.avatar) memberPayload.avatar_url = updates.avatar;\n\n    if (updates.phone) privatePayload.phone = updates.phone;\n    if (updates.email) privatePayload.email = updates.email;\n    if (updates.address) privatePayload.address = updates.address;\n    if (updates.dob) privatePayload.dob = updates.dob;\n    if (updates.goals) privatePayload.personal_goals = updates.goals;\n    if (updates.vision) privatePayload.future_vision = updates.vision;\n\n    // Run updates separately depending on which data is provided\n    if (Object.keys(memberPayload).length > 0)\n      await supabase.from('user_member').update(memberPayload).eq('id', user.id);\n\n    if (Object.keys(privatePayload).length > 0)\n      await supabase.from('user_private').update(privatePayload).eq('id', user.id);\n\n    return { success: true };\n  } catch (error) {\n    console.error('Update user profile failed:', error);\n    return { success: false, error };\n  }\n};\n","import React, { useState, useEffect } from \"react\"\nimport { navigate } from \"gatsby\"\nimport { handleLogin } from \"../../database/functions\"\nimport { supabase } from \"../../database/supabaseClient\"\n\nexport default function Login() {\n  const [email, setEmail] = useState(\"\")\n  const [password, setPassword] = useState(\"\")\n  const [message, setMessage] = useState(\"\")\n\n  useEffect(() => {\n    supabase.auth.getSession().then(({ data }) => {\n      if (data.session) navigate(\"/members/dashboard\")\n    })\n  }, [])\n\n  const onSuccess = () => {\n    setMessage(\"‚úÖ Login successful! Redirecting...\")\n    setTimeout(() => navigate(\"/members/dashboard\"), 1000)\n  }\n\n  const onFail = (err?: string) => {\n    setMessage(\"‚ùå \" + (err || \"Invalid credentials.\"))\n  }\n\n  return (\n    <div style={{ maxWidth: 400, margin: \"auto\", padding: 20, display: \"flex\", flexDirection: \"column\", gap: 10, color : 'white'}}>\n      <h2 style={{ textAlign: \"center\" }}>Login</h2>\n\n      <form\n        onSubmit={(e) => {\n          e.preventDefault()\n          handleLogin({ email, password, onSuccess, onFail })\n        }}\n        style={{ display: \"flex\", flexDirection: \"column\", gap: 10 }}\n      >\n        <input\n          type=\"email\"\n          placeholder=\"Email\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          required\n          style={{ padding: 10, border: \"1px solid #ccc\", borderRadius: 5 }}\n        />\n\n        <input\n          type=\"password\"\n          placeholder=\"Password\"\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n          required\n          style={{ padding: 10, border: \"1px solid #ccc\", borderRadius: 5 }}\n        />\n\n        <button\n          type=\"submit\"\n          style={{\n            padding: 10,\n            borderRadius: 5,\n            background: \"#1976D2\",\n            color: \"#fff\",\n            border: \"none\",\n            cursor: \"pointer\",\n          }}\n        >\n          Login\n        </button>\n      </form>\n\n      {message && <p style={{ textAlign: \"center\", marginTop: 10 }}>{message}</p>}\n    </div>\n  )\n}\n","export function getSupabaseAuthKeys() {\n  return Object.keys(localStorage).filter(k =>\n    k.startsWith(\"sb-\") && k.includes(\"-auth-token\")\n  );\n}\n\n// Save session keys after successful login\nexport function saveValidSupabaseKeys() {\n  const keys = getSupabaseAuthKeys();\n  if (keys.length === 0) return;\n\n  const store: Record<string, string> = {};\n  keys.forEach(k => (store[k] = localStorage.getItem(k) || \"\"));\n\n  localStorage.setItem(\"__thv_valid_supabase_keys__\", JSON.stringify(store));\n}\n\n// Restore missing / damaged keys BEFORE login\nexport function repairSupabaseKeysIfBroken() {\n  const saved = localStorage.getItem(\"__thv_valid_supabase_keys__\");\n  if (!saved) return;\n\n  const good = JSON.parse(saved);\n  Object.keys(good).forEach(k => {\n    if (!localStorage.getItem(k)) {\n      console.log(\"üõ† Restoring missing Supabase key:\", k);\n      localStorage.setItem(k, good[k]);\n    }\n  });\n}\n\n// Remove corrupted keys\nexport function clearStaleSupabaseKeys() {\n  const saved = JSON.parse(localStorage.getItem(\"__thv_valid_supabase_keys__\") || \"{}\");\n  const current = getSupabaseAuthKeys();\n\n  current.forEach(k => {\n    if (!saved[k]) {\n      console.log(\"üß® Removing stale Supabase key:\", k);\n      localStorage.removeItem(k);\n    }\n  });\n}\n"],"names":["handleLogout","async","onSuccess","onFail","console","log","clearStaleSupabaseKeys","error","supabase","auth","signOut","message","localStorage","removeItem","handleSignup","email","password","fullName","data","signUp","options","full_name","signup_source","handleLogin","signInWithPassword","handleResetPassword","resetPasswordForEmail","handleUpdatePassword","newPassword","updateUser","Login","setEmail","useState","setPassword","setMessage","useEffect","getSession","then","_ref","session","navigate","setTimeout","err","React","style","maxWidth","margin","padding","display","flexDirection","gap","color","textAlign","onSubmit","e","preventDefault","type","placeholder","value","onChange","target","required","border","borderRadius","background","cursor","marginTop","getSupabaseAuthKeys","Object","keys","filter","k","startsWith","includes","saveValidSupabaseKeys","length","store","forEach","getItem","setItem","JSON","stringify","repairSupabaseKeysIfBroken","saved","good","parse"],"sourceRoot":""}