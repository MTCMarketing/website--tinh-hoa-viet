"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2412],{599:function(e,a,t){t.d(a,{T4:function(){return c},mg:function(){return r},tp:function(){return i},vM:function(){return o},vx:function(){return l}});var n=t(6634),s=t(6898);const l=async function(e){let{onSuccess:a,onFail:t}=void 0===e?{}:e;console.log("ðŸ” Logging outâ€¦"),(0,n.nR)();const{error:l}=await s.ND.auth.signOut();if(l)return console.error("âŒ Logout error:",l),null==t?void 0:t(l.message);(0,n.nR)(),localStorage.removeItem("__thv_valid_supabase_keys__"),null==a||a()},o=async e=>{let{email:a,password:t,fullName:n,onSuccess:l,onFail:o}=e;const{data:r,error:c}=await s.ND.auth.signUp({email:a,password:t,options:{data:{full_name:n||"unknown",signup_source:"thv-web"}}});c?null==o||o(c.message):null==l||l()},r=async e=>{let{email:a,password:t,onSuccess:n,onFail:l}=e;const{data:o,error:r}=await s.ND.auth.signInWithPassword({email:a,password:t});r?null==l||l(r.message):null==n||n()},c=async e=>{let{email:a,onSuccess:t,onFail:n}=e;const{data:l,error:o}=await s.ND.auth.resetPasswordForEmail(a);o?null==n||n(o.message):null==t||t()},i=async e=>{let{newPassword:a,onSuccess:t,onFail:n}=e;const{data:l,error:o}=await s.ND.auth.updateUser({password:a});o?null==n||n(o.message):null==t||t()}},6634:function(e,a,t){function n(){return Object.keys(localStorage).filter(e=>e.startsWith("sb-")&&e.includes("-auth-token"))}function s(){const e=n();if(0===e.length)return;const a={};e.forEach(e=>a[e]=localStorage.getItem(e)||""),localStorage.setItem("__thv_valid_supabase_keys__",JSON.stringify(a))}function l(){const e=localStorage.getItem("__thv_valid_supabase_keys__");if(!e)return;const a=JSON.parse(e);Object.keys(a).forEach(e=>{localStorage.getItem(e)||(console.log("ðŸ›  Restoring missing Supabase key:",e),localStorage.setItem(e,a[e]))})}function o(){const e=JSON.parse(localStorage.getItem("__thv_valid_supabase_keys__")||"{}");n().forEach(a=>{e[a]||(console.log("ðŸ§¨ Removing stale Supabase key:",a),localStorage.removeItem(a))})}t.d(a,{ID:function(){return l},Uf:function(){return s},nR:function(){return o}})},7554:function(e,a,t){t.r(a),t.d(a,{default:function(){return u}});var n=t(6540),s=t(5268),l=t(3),o=t(6898),r=t(599),c=t(6634);const i={EN:{brandTitle:"TINH HOA VIá»†T",tagline:"Where Vietnamese Excellence Meets Global Recognition",features:["Premium Vietnamese Heritage","Global Excellence Standards","Elite Community Access"],title:"Welcome Back",subtitle:"Log in to continue your journey of excellence",email:"Email Address",password:"Password",remember:"Remember Me",forgot:"Forgot Password?",submit:"Sign In",noAccount:"Don't have an account? ",signup:"Create One Now",langEN:"EN",langVN:"VN"},VN:{brandTitle:"TINH HOA VIá»†T",tagline:"NÆ¡i tÃ´n vinh tinh hoa Viá»‡t Nam vÆ°Æ¡n táº§m quá»‘c táº¿",features:["Di sáº£n Viá»‡t Nam Ä‘áº³ng cáº¥p","Chuáº©n má»±c xuáº¥t sáº¯c toÃ n cáº§u","Cá»™ng Ä‘á»“ng tinh hoa"],title:"ChÃ o má»«ng trá»Ÿ láº¡i",subtitle:"ÄÄƒng nháº­p Ä‘á»ƒ tiáº¿p tá»¥c hÃ nh trÃ¬nh tinh hoa",email:"Äá»‹a chá»‰ Email",password:"Máº­t kháº©u",remember:"Ghi nhá»› Ä‘Äƒng nháº­p",forgot:"QuÃªn máº­t kháº©u?",submit:"ÄÄƒng Nháº­p",noAccount:"ChÆ°a cÃ³ tÃ i khoáº£n? ",signup:"Táº¡o tÃ i khoáº£n ngay",langEN:"EN",langVN:"VN"}};var m=e=>{let{route:a}=e;const{0:t,1:m}=(0,n.useState)({email:"",password:"",remember:!1}),{0:u,1:d}=(0,n.useState)("EN"),{0:g,1:h}=(0,n.useState)(""),p=i[u];(0,n.useEffect)(()=>{o.ND.auth.getSession().then(e=>{var a,t,n;let{data:s}=e;console.log("ðŸ” Login page mount â€” existing session:",s);const l=null===(a=s.session)||void 0===a||null===(t=a.user)||void 0===t||null===(n=t.user_metadata)||void 0===n?void 0:n.role;s.session&&N(l)})},[]);const N=e=>{var t,n;return console.log("âž¡ï¸ Redirect with role:",e),e&&null!=a&&null!==(t=a[e])&&void 0!==t&&t.onTrue?(0,s.navigate)(a[e].onTrue):e&&null!=a&&null!==(n=a[e])&&void 0!==n&&n.onFalse?(0,s.navigate)(a[e].onFalse):void(0,s.navigate)("/event/aid/checkout")},E=async()=>{var e,a,t;console.log("âœ… Login succeeded â€” verifying sessionâ€¦");const{data:n}=await o.ND.auth.getSession();console.log("ðŸ” Fresh session:",n),(0,c.Uf)();const s=null===(e=n.session)||void 0===e||null===(a=e.user)||void 0===a||null===(t=a.user_metadata)||void 0===t?void 0:t.role;h("Login successful!"),setTimeout(()=>N(s),900)},v=e=>{console.log("âŒ Login failed:",e),h("âŒ "+(e||"Invalid credentials."))},f=e=>{const{name:a,value:t,type:n,checked:s}=e.target;m(e=>Object.assign({},e,{[a]:"checkbox"===n?s:t}))};return n.createElement("div",{className:"auth-shell"},n.createElement("aside",{className:"brand-side","aria-hidden":!0},n.createElement("div",{className:"brand-sheen"}),n.createElement("div",{className:"brand-pattern"}),n.createElement("div",{className:"brand-wrap"},n.createElement("h1",{className:"brand-name"},p.brandTitle),n.createElement("p",{className:"brand-tag"},p.tagline),n.createElement("ul",{className:"brand-features"},p.features.map((e,a)=>n.createElement("li",{className:"feature",key:a},n.createElement("span",{className:"tick"},"âœ“"),n.createElement("span",null,e)))))),n.createElement("main",{className:"form-side"},n.createElement("header",{className:"form-top"},n.createElement("div",{className:"lang-switch"},n.createElement("button",{className:"lang "+("EN"===u?"active":""),onClick:()=>d("EN")},p.langEN),n.createElement("span",{className:"mid"},"|"),n.createElement("button",{className:"lang "+("VN"===u?"active":""),onClick:()=>d("VN")},p.langVN))),n.createElement("section",{className:"form-wrap"},n.createElement("div",{className:"intro"},n.createElement("h2",{className:"title"},p.title),n.createElement("p",{className:"subtitle"},p.subtitle)),n.createElement("form",{onSubmit:e=>{e.preventDefault(),(0,c.ID)(),console.log("ðŸ§¹ Clearing stale Supabase keys BEFORE loginâ€¦"),Object.keys(localStorage).forEach(e=>{e.startsWith("sb-")&&(console.log("ðŸ§¨ Removing stale key:",e),localStorage.removeItem(e))}),console.log("ðŸ“¦ localStorage AFTER wipe:",Object.keys(localStorage)),(0,r.mg)({email:t.email,password:t.password,onSuccess:E,onFail:v})},className:"auth-form"},n.createElement("div",{className:"field"},n.createElement("label",{htmlFor:"email"},p.email),n.createElement("input",{type:"email",id:"email",name:"email",value:t.email,onChange:f,placeholder:"EN"===u?"your.email@example.com":"email@vi-du.com",required:!0})),n.createElement("div",{className:"field"},n.createElement("label",{htmlFor:"password"},p.password),n.createElement("input",{type:"password",id:"password",name:"password",value:t.password,onChange:f,placeholder:"EN"===u?"Enter your password":"Nháº­p máº­t kháº©u",required:!0})),n.createElement("div",{className:"options"},n.createElement("label",{className:"remember"},n.createElement("input",{type:"checkbox",name:"remember",checked:t.remember,onChange:f}),p.remember),n.createElement("a",{href:"/reset-password",className:"forgot"},p.forgot)),n.createElement("button",{type:"submit",className:"cta"},n.createElement("span",null,p.submit),n.createElement(l.dyV,{className:"arrow"})),g&&n.createElement("p",{style:{textAlign:"center",marginTop:10,color:"#fff"}},g),n.createElement("p",{className:"switch"},p.noAccount,n.createElement("a",{href:"/sign-up"},p.signup))))))};var u=()=>n.createElement("div",null,n.createElement(m,{route:{admin:{onTrue:"/cms"}}}))}}]);
//# sourceMappingURL=component---src-pages-sign-in-tsx-fdd4f235187040a4ce59.js.map