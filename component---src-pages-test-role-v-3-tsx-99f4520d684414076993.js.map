{"version":3,"file":"component---src-pages-test-role-v-3-tsx-99f4520d684414076993.js","mappings":"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","sources":["webpack:///./src/pages/test/role-v3.tsx"],"sourcesContent":["// src/pages/test-role-2.tsx\nimport * as React from \"react\";\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"../../database/supabaseClient\";\n\nconst OWNER_IDS = {\n  user1: \"02c567a2-b193-4009-89e5-884386540733\",\n  admin: \"6c77d859-1af1-418e-b0e0-0d3cc4e80fad\",\n  slapkommerce: \"d3ca3641-e106-4a4d-a288-bb3e0c4e3a9a\",\n};\n\nconst TestRole2Page: React.FC = () => {\n  const [uid, setUid] = useState<string | null>(null);\n  const [email, setEmail] = useState<string | null>(null);\n  const [role, setRole] = useState<string | null>(null);\n  const [results, setResults] = useState<Record<string, any[]>>({});\n  const [summaries, setSummaries] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const runTests = async () => {\n      try {\n        setLoading(true);\n\n        const { data: sessionData, error: sessionErr } = await supabase.auth.getSession();\n        if (sessionErr) throw sessionErr;\n        const user = sessionData?.session?.user;\n        if (!user) throw new Error(\"No logged-in user found\");\n\n        setUid(user.id);\n        setEmail(user.email || null);\n\n        const { data: roleData } = await supabase\n          .from(\"user_roles\")\n          .select(\"role\")\n          .eq(\"id\", user.id)\n          .maybeSingle();\n\n        const userRole = roleData?.role || \"none\";\n        setRole(userRole);\n\n        const newResults: Record<string, any[]> = {};\n        const newSummaries: Record<string, string> = {};\n\n        const selects = [\n          [\"(1) From user1@test.com\", { owner_id: OWNER_IDS.user1 }],\n          [\"(2) From admin@test.com\", { owner_id: OWNER_IDS.admin }],\n          [\"(3) From slapkommerce@gmail.com\", { owner_id: OWNER_IDS.slapkommerce }],\n          [\"(4) All member-role rows\", { role: \"member\" }],\n          [\"(5) All admin-role rows\", { role: \"admin\" }],\n          [\"(6) Select all rows\", {}],\n        ];\n\n        for (const [label, filter] of selects) {\n          let query = supabase.from(\"user_private_v2\").select(\"*\");\n          for (const [key, value] of Object.entries(filter)) query = query.eq(key, value);\n          const { data } = await query;\n\n          newResults[label] = data || [];\n          newSummaries[label] = data?.length\n            ? `‚úÖ ${data.length} rows visible`\n            : \"‚ö†Ô∏è No rows (RLS restricted)\";\n        }\n\n        for (const [label, rows] of Object.entries(newResults)) {\n          if (!rows?.length) continue;\n\n          const updated: any[] = [];\n          let successCount = 0;\n          let errorCount = 0;\n          let wrongSuccess = false;\n\n          for (const row of rows) {\n            const now = new Date();\n            const hh = String(now.getHours()).padStart(2, \"0\");\n            const mm = String(now.getMinutes()).padStart(2, \"0\");\n            const ss = String(now.getSeconds()).padStart(2, \"0\");\n            const timestamp = `${hh}:${mm}:${ss}`;\n\n            const base = typeof row.email === \"string\" ? row.email.replace(/\\s?\\d{2}:\\d{2}:\\d{2}$/, \"\") : \"\";\n            const newValue = `${base} ${timestamp}`.trim();\n\n            const { data: upd, error: updErr } = await supabase\n              .from(\"test_table_2\")\n              .update({ email: newValue })\n              .eq(\"id\", row.id)\n              .select();\n\n            if (updErr) {\n              updated.push({ id: row.id, error: updErr.message });\n              errorCount++;\n            } else {\n              updated.push({ id: row.id, updated_to: newValue });\n              successCount++;\n              if (userRole === \"member\" && row.owner_id !== user.id) wrongSuccess = true;\n            }\n          }\n\n          let status = \"\";\n          if (userRole === \"admin\")\n            status = `‚úÖ ${successCount} success (should succeed for admin)`;\n          else if (userRole === \"member\") {\n            if (wrongSuccess)\n              status = `‚ùå ${successCount} success (should have failed for non-owned rows)`;\n            else if (successCount > 0)\n              status = `‚úÖ ${successCount} success (should succeed only on own rows)`;\n            else status = `‚ö†Ô∏è ${errorCount} failed (expected for restricted rows)`;\n          } else {\n            status = errorCount\n              ? `‚úÖ ${errorCount} failed (unauthenticated expected)`\n              : `‚ùå ${successCount} success (should have failed)`;\n          }\n\n          newResults[`WRITE TEST for ${label}`] = updated;\n          newSummaries[`WRITE TEST for ${label}`] = status;\n        }\n\n        setResults(newResults);\n        setSummaries(newSummaries);\n      } catch (err: any) {\n        console.error(err);\n        setError(err.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    runTests();\n  }, []);\n\n  return (\n    <div style={{ width: \"100%\", minHeight: \"100vh\", background: \"#fff\" }}>\n      <main style={{ fontFamily: \"sans-serif\", padding: \"2rem\" }}>\n        <h1>üß© Supabase Role Access + Write Timestamp Test (test_table_2)</h1>\n        {loading ? (\n          <p>Loading...</p>\n        ) : error ? (\n          <p style={{ color: \"red\" }}>Error: {error}</p>\n        ) : (\n          <>\n            <p><strong>Logged in as:</strong> {email}</p>\n            <p><strong>UID:</strong> {uid}</p>\n            <p><strong>Role (via user_roles):</strong> {role}</p>\n            <hr />\n            {Object.entries(results).map(([label, rows]) => (\n              <section key={label} style={{ marginBottom: \"2rem\" }}>\n                <h3>{label}</h3>\n                <p\n                  style={{\n                    fontWeight: \"bold\",\n                    color:\n                      summaries[label]?.includes(\"‚ùå\") ? \"red\" :\n                      summaries[label]?.includes(\"‚ö†Ô∏è\") ? \"orange\" :\n                      \"green\",\n                  }}\n                >\n                  {summaries[label]}\n                </p>\n                {rows.length === 0 ? (\n                  <p style={{ color: \"#999\" }}>No rows visible (RLS restricted)</p>\n                ) : (\n                  <pre style={{\n                    background: \"#f8f8f8\",\n                    padding: \"1rem\",\n                    borderRadius: \"8px\",\n                    overflowX: \"auto\"\n                  }}>\n                    {JSON.stringify(rows, null, 2)}\n                  </pre>\n                )}\n              </section>\n            ))}\n          </>\n        )}\n      </main>\n    </div>\n  );\n};\n\nexport default TestRole2Page;\n"],"names":["OWNER_IDS","TestRole2Page","uid","setUid","useState","email","setEmail","role","setRole","results","setResults","summaries","setSummaries","loading","setLoading","error","setError","useEffect","async","data","sessionData","sessionErr","supabase","auth","getSession","user","session","_sessionData$session","Error","id","roleData","from","select","eq","maybeSingle","userRole","newResults","newSummaries","selects","owner_id","label","filter","query","key","value","Object","entries","length","rows","updated","successCount","errorCount","wrongSuccess","row","now","Date","hh","String","getHours","padStart","mm","getMinutes","timestamp","getSeconds","newValue","replace","trim","upd","updErr","update","push","message","updated_to","status","err","console","runTests","React","style","width","minHeight","background","fontFamily","padding","color","map","_ref","marginBottom","fontWeight","_summaries$label","includes","_summaries$label2","borderRadius","overflowX","JSON","stringify"],"sourceRoot":""}