"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3480],{3515:function(e,t,n){n.r(t),n.d(t,{default:function(){return d}});var r=n(6540),a=n(6462),o=n(5458),i=n(3),l=n(6898);const s=()=>{const{0:e,1:t}=(0,r.useState)(""),{0:n,1:a}=(0,r.useState)([]),{0:s,1:d}=(0,r.useState)([]),{0:c,1:u}=(0,r.useState)(!1),{0:p,1:f}=(0,r.useState)(null),m=(0,r.useRef)(null),g=(0,r.useRef)(null);(0,r.useEffect)(()=>{l.ND.auth.getSession().then(e=>{var t,n,r;let{data:a}=e;const o=null!==(t=null===(n=a.session)||void 0===n||null===(r=n.user)||void 0===r?void 0:r.id)&&void 0!==t?t:null;f(o)})},[]),(0,r.useEffect)(()=>{(async()=>{var e;const{data:t}=await l.ND.auth.getSession(),n=null==t||null===(e=t.session)||void 0===e?void 0:e.user;if(!n)return;const{data:r,error:o}=await l.ND.from("dm_messages").select("*").or("sender_id.eq."+n.id+",recipient_id.eq."+n.id).order("created_at",{ascending:!0});!o&&r&&a(r)})()},[]),(0,r.useEffect)(()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[n]);const v=async()=>{if(e.trim()||0!==s.length){u(!0);try{var n,r;const{data:i}=await l.ND.auth.getSession(),s=null==i||null===(n=i.session)||void 0===n||null===(r=n.user)||void 0===r?void 0:r.id;if(!s)throw new Error("Not authenticated.");const{data:c,error:u}=await l.ND.from("dm_messages").insert([{sender_id:s,message:e,recipient_id:null}]).select();if(u)throw u;a(e=>[].concat((0,o.A)(e),[c[0]])),t(""),d([])}catch(i){console.error("âŒ Send failed:",i.message),alert(i.message)}finally{u(!1)}}};return r.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"#f9fafb",color:"#111827"}},r.createElement("div",{style:{flexGrow:1,overflowY:"auto",padding:"20px",paddingBottom:"100px"}},n.map(e=>{const t=e.sender_id===p;return r.createElement("div",{key:e.id,style:{display:"flex",justifyContent:t?"flex-end":"flex-start",marginBottom:"10px"}},r.createElement("div",{style:{background:t?"#00838F":"#E2E8F0",color:t?"white":"#1E293B",borderRadius:"12px",padding:"10px 14px",maxWidth:"70%",wordBreak:"break-word"}},r.createElement("div",{style:{fontSize:"14px"}},e.message),r.createElement("div",{style:{fontSize:"11px",marginTop:"4px",opacity:.6,textAlign:t?"right":"left"}},new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))))}),r.createElement("div",{ref:g})),r.createElement("div",{style:{position:"sticky",bottom:0,left:0,right:0,background:"#fff",borderTop:"1px solid #e5e7eb",padding:"12px 20px",display:"flex",alignItems:"center",gap:"10px"}},r.createElement("button",{onClick:()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.click()},style:{background:"none",border:"none",color:"#0369a1",cursor:"pointer"}},r.createElement(i._mV,{size:18})),r.createElement("input",{type:"file",ref:m,multiple:!0,onChange:e=>{if(e.target.files){const t=Array.from(e.target.files);d(e=>[].concat((0,o.A)(e),t))}},style:{display:"none"}}),r.createElement("input",{value:e,onChange:e=>t(e.target.value),placeholder:"Type your message...",style:{flexGrow:1,borderRadius:"8px",border:"1px solid #d1d5db",padding:"10px",fontSize:"14px"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v())}}),r.createElement("button",{onClick:v,disabled:c,style:{background:"#00838F",color:"white",border:"none",borderRadius:"8px",padding:"10px 14px",fontWeight:500,cursor:"pointer",opacity:c?.8:1,display:"flex",alignItems:"center",gap:"6px"}},r.createElement(i.kGk,{size:18}))))};var d=()=>{const e=(0,a.useLocation)(),t=(0,r.useMemo)(()=>{const t=((null==e?void 0:e.pathname)||"").replace(/\/+$/,"").split("/");return t[t.length-1]||void 0},[null==e?void 0:e.pathname]);return r.createElement(s,{messageId:t})}}}]);
//# sourceMappingURL=component---src-pages-members-dashboard-message-[id]-index-tsx-dc27bb42e3f684278a3c.js.map