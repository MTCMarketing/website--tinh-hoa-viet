"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7876],{856:function(e,t,a){var l=a(6540),n=a(4794),s=a(6898);const r={EN:{brandTitle:"TINH HOA VIỆT",tagline:"Where Vietnamese Excellence Meets Global Recognition",loading:"Checking authentication...",redirect:"Redirecting..."},VN:{brandTitle:"TINH HOA VIỆT",tagline:"Nơi tôn vinh tinh hoa Việt Nam vươn tầm quốc tế",loading:"Đang kiểm tra xác thực...",redirect:"Đang chuyển hướng..."}};t.A=e=>{let{children:t,redirectTo:a="/members/login",language:i="EN"}=e;const{0:c,1:o}=(0,l.useState)(null),{0:m,1:d}=(0,l.useState)(r[i].loading),{0:u,1:E}=(0,l.useState)(!0),N=r[i];return(0,l.useEffect)(()=>{(async()=>{const{data:e,error:t}=await s.ND.auth.getSession();if(t)return console.error("Session error:",t),d("⚠️ Error checking session."),void E(!1);e.session?(o(e.session),d("✅ Access granted!")):(d("❌ You must be logged in to view this page."),setTimeout(()=>(0,n.navigate)(a),1800)),E(!1)})();const{data:e}=s.ND.auth.onAuthStateChange((e,t)=>{o(t),t||(d(N.redirect),setTimeout(()=>(0,n.navigate)(a),1500))});return()=>{e.subscription.unsubscribe()}},[a,N.redirect]),u||!c?l.createElement("div",{className:"auth-shell"},l.createElement("aside",{className:"brand-side","aria-hidden":!0},l.createElement("div",{className:"brand-sheen"}),l.createElement("div",{className:"brand-pattern"}),l.createElement("div",{className:"brand-wrap"},l.createElement("h1",{className:"brand-name"},N.brandTitle),l.createElement("p",{className:"brand-tag"},N.tagline))),l.createElement("main",{className:"form-side"},l.createElement("div",{className:"loading-block"},l.createElement("div",{className:"spinner"}),l.createElement("p",{className:"loading-text"},m)))):l.createElement(l.Fragment,null,t)}},7799:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var l=a(6540),n=a(4506),s=a(3),r=a(8027),i=a(6898);var c=a(7843);const o=async e=>{try{var t,a;console.log("🟡 updateUserProfile called with:",e);const{data:l,error:n}=await i.ND.auth.getSession();if(n)throw n;const s=null==l||null===(t=l.session)||void 0===t?void 0:t.user,r=null==l||null===(a=l.session)||void 0===a?void 0:a.access_token;if(console.log("🟢 AUTH CHECK →",{userId:(null==s?void 0:s.id)||"❌ no user",tokenPrefix:r?r.substring(0,30)+"...":"❌ no token"}),!s)throw new Error("Not logged in");const c={},o={};e.fullName&&(c.full_name=e.fullName),e.hometown&&(c.hometown=e.hometown),e.field&&(c.field_of_expertise=e.field),e.status&&(c.profile_status=e.status),e.avatar&&(c.avatar_url=e.avatar),e.phone&&(o.phone=e.phone),e.email&&(o.email=e.email),e.address&&(o.address=e.address),e.dob&&(o.dob=e.dob),e.goals&&(o.personal_goals=e.goals),e.vision&&(o.future_vision=e.vision),console.log("🟣 Payloads →",{memberPayload:c,privatePayload:o}),await i.ND.from("user_member").upsert({id:s.id}).eq("id",s.id),await i.ND.from("user_private").upsert({id:s.id}).eq("id",s.id);let m=null,d=null;return Object.keys(c).length>0&&(m=await i.ND.from("user_member").update(c).eq("id",s.id).select("*"),console.log("🟢 user_member update →",m)),Object.keys(o).length>0&&(d=await i.ND.from("user_private").update(o).eq("id",s.id).select("*"),console.log("🟢 user_private update →",d)),{success:!0}}catch(l){return console.error("❌ Update failed:",l.message),{success:!1,error:l}}},m={fullName:"Nguyen Van A",phone:"0901234567",email:"user1@test.com",dob:"1990-01-01",address:"123 Hue St",hometown:"Hue",field:"Cultural Research",goals:"Promote Vietnamese heritage globally",vision:"Bridge traditional and modern culture through technology",status:"Step 2: Under review by Editorial Department"},d=(0,l.memo)(e=>{let{field:t,userData:a,editingField:n,tempValue:r,onEditStart:i,onSave:c,onCancel:o,onTempValueChange:m}=e;return l.createElement("div",{className:"profile-field"},l.createElement("label",null,t.icon,t.label),l.createElement("div",{className:"field-value"},n===t.key?l.createElement("div",{className:"edit-controls"},l.createElement("input",{type:"text",value:r,onChange:e=>m(e.target.value),className:"edit-input",autoFocus:!0}),l.createElement("div",{className:"edit-actions"},l.createElement("button",{className:"save-btn",onClick:()=>c(t.key)},l.createElement(s.Bc_,null)),l.createElement("button",{className:"cancel-btn",onClick:o},l.createElement(s.yGN,null)))):l.createElement(l.Fragment,null,l.createElement("span",null,a[t.key]),l.createElement("button",{className:"edit-btn",onClick:()=>i(t.key,a[t.key])},l.createElement(s.SG1,null)))))}),u=(0,l.memo)(e=>{let{step:t,index:a,totalSteps:n}=e;return l.createElement("div",{className:"timeline-step "+(t.completed?"completed":"")+" "+(t.current?"current":"")},l.createElement("div",{className:"step-marker"},t.completed?l.createElement(s.A3x,null):t.step),l.createElement("div",{className:"step-content"},l.createElement("h4",null,"Step ",t.step),l.createElement("p",null,t.label)),a<n-1&&l.createElement("div",{className:"step-connector"}))}),E=(0,l.memo)(e=>{let{item:t}=e;return l.createElement("div",{className:"history-item"},l.createElement("div",{className:"history-icon"},t.icon),l.createElement("div",{className:"history-content"},l.createElement("p",{className:"history-action"},t.action),l.createElement("span",{className:"history-time"},t.time)))});var N=()=>{const{0:e,1:t}=(0,l.useState)(m),{0:a,1:N}=(0,l.useState)(null),{0:v,1:g}=(0,l.useState)(""),{0:p,1:y}=(0,l.useState)(""),{0:h,1:b}=(0,l.useState)(!0),{0:M,1:f}=(0,l.useState)(!1),{0:k,1:j}=(0,l.useState)(Object.assign({},m)),{0:w,1:I}=(0,l.useState)([]),S=(0,l.useRef)(null),D=(0,l.useMemo)(()=>[{step:1,label:"Profile Submitted",completed:!0},{step:2,label:"Under Review",completed:!0,current:!0},{step:3,label:"Evaluation",completed:!1},{step:4,label:"Approved",completed:!1}],[]);(0,l.useEffect)(()=>{(async()=>{try{b(!0);const{data:{session:e}}=await i.ND.auth.getSession(),a=null==e?void 0:e.user;if(console.log("🟢 Loaded session:",null==a?void 0:a.id),!a)throw new Error("Not logged in");const{data:l}=await i.ND.from("user_member").select("*").eq("id",a.id).single(),{data:n}=await i.ND.from("user_private").select("*").eq("id",a.id).single(),{data:s}=await i.ND.from("user_activity_log").select("action, created_at").eq("user_id",a.id).order("created_at",{ascending:!1}).limit(10),r={fullName:(null==l?void 0:l.full_name)||"",email:(null==n?void 0:n.email)||a.email||"",phone:(null==n?void 0:n.phone)||"",address:(null==n?void 0:n.address)||"",hometown:(null==l?void 0:l.hometown)||"",field:(null==l?void 0:l.field_of_expertise)||"",dob:(null==n?void 0:n.dob)||"",goals:(null==n?void 0:n.personal_goals)||"",vision:(null==n?void 0:n.future_vision)||"",status:(null==l?void 0:l.profile_status)||"",avatar:(null==l?void 0:l.avatar_url)||""};t(r),j(r),I(s||[]),r.avatar&&y(r.avatar),localStorage.setItem("user",JSON.stringify(r))}catch(e){console.warn("⚠️ No profile data found:",e),t(m)}finally{b(!1)}})()},[]);const A=(e,t)=>{N(e),g(t)},x=async a=>{const l=Object.assign({},e,{[a]:v});t(l),localStorage.setItem("user",JSON.stringify(l)),b(!0);const n=await o({[a]:v});var s;(b(!1),n.success)?(alert("✅ Saved!"),N(null)):alert("❌ Failed: "+(null===(s=n.error)||void 0===s?void 0:s.message))},C=()=>{N(null),g("")};return h?l.createElement("div",{className:"dashboard-loading"},l.createElement("div",{className:"loading-spinner"}),l.createElement("p",null,"Loading your dashboard...")):l.createElement("div",{className:"luxury-dashboard"},l.createElement("header",{className:"dashboard-header"},l.createElement("div",{className:"header-content"},l.createElement("div",{className:"brand-section"},l.createElement("h1",null,"Cultural Excellence Dashboard")),l.createElement("div",{className:"header-actions"},l.createElement("button",{className:"header-btn",onClick:()=>window.location.href="/"},l.createElement(s.V5Y,null),l.createElement("span",null,"Home")),l.createElement("button",{className:"header-btn logout",onClick:()=>window.location.href="/sign-out"},l.createElement(s.QeK,null),l.createElement("span",null,"Logout"))))),l.createElement("div",{className:"dashboard-content"},l.createElement("div",{className:"content-grid"},l.createElement("div",{className:"left-column"},l.createElement("div",{className:"profile-card luxury-card"},l.createElement("div",{className:"card-header"},l.createElement("h2",null,"Profile Overview"),l.createElement("div",{className:"status-badge"},l.createElement(s.A3x,null),l.createElement("span",null,"Active Member"))),l.createElement("div",{className:"avatar-section"},l.createElement("div",{className:"avatar-container",onClick:()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.click()}},l.createElement(c.A,{url:p||"/default-avatar.png",width:100,height:100,className:"profile-avatar"}),false),l.createElement("div",{className:"avatar-info"},l.createElement("h3",null,e.fullName),l.createElement("p",{className:"user-title"},"Cultural Ambassador"),l.createElement("div",{className:"rating"},(0,n.A)(Array(5)).map((e,t)=>l.createElement(r.gt3,{key:t})),l.createElement("span",null,"Elite Member")))),l.createElement("div",{className:"profile-details"},[{key:"fullName",label:"Full Name",icon:l.createElement(s.JXP,null)},{key:"phone",label:"Phone Number",icon:l.createElement(r.tz0,null)},{key:"email",label:"Email",icon:l.createElement(s.JXP,null)},{key:"dob",label:"Date of Birth",icon:l.createElement(r.Z0L,null)},{key:"address",label:"Address",icon:l.createElement(s.V5Y,null)},{key:"hometown",label:"Hometown",icon:l.createElement(r.tz0,null)},{key:"field",label:"Field of Expertise",icon:l.createElement(r.Z0L,null)}].map(t=>l.createElement(d,{key:t.key,field:t,userData:e,editingField:a,tempValue:v,onEditStart:A,onSave:x,onCancel:C,onTempValueChange:g})))),l.createElement("div",{className:"status-card luxury-card"},l.createElement("div",{className:"card-header"},l.createElement("h2",null,"Application Progress"),l.createElement("div",{className:"progress-text"},"75% Complete")),l.createElement("div",{className:"timeline"},D.map((e,t)=>l.createElement(u,{key:e.step,step:e,index:t,totalSteps:D.length}))))),l.createElement("div",{className:"right-column"},l.createElement("div",{className:"status-highlight luxury-card"},l.createElement("div",{className:"status-header"},l.createElement(s.A3x,{className:"status-icon"}),l.createElement("div",null,l.createElement("h3",null,"Profile Status"),l.createElement("p",null,e.status))),l.createElement("div",{className:"progress-bar"},l.createElement("div",{className:"progress-fill",style:{width:"75%"}})),l.createElement("div",{className:"status-actions"},l.createElement("button",{className:"action-btn primary"},"View Details"),l.createElement("button",{className:"action-btn secondary"},"Contact Support"))),l.createElement("div",{className:"goals-card luxury-card"},l.createElement("div",{className:"card-header"},l.createElement("h2",null,"Goals & Vision")),l.createElement("div",{className:"goals-content"},["goals","vision"].map(t=>l.createElement("div",{className:"vision-field",key:t},l.createElement("label",null,"goals"===t?"Personal Goals":"Future Vision"),l.createElement("div",{className:"field-value"},a===t?l.createElement("div",{className:"edit-controls"},l.createElement("textarea",{value:v,onChange:e=>g(e.target.value),rows:3,className:"edit-textarea"}),l.createElement("div",{className:"edit-actions"},l.createElement("button",{className:"save-btn",onClick:()=>x(t)},l.createElement(s.Bc_,null)),l.createElement("button",{className:"cancel-btn",onClick:C},l.createElement(s.yGN,null)))):l.createElement(l.Fragment,null,l.createElement("p",null,e[t]),l.createElement("button",{className:"edit-btn",onClick:()=>A(t,e[t])},l.createElement(s.SG1,null)))))))),l.createElement("div",{className:"history-card luxury-card"},l.createElement("div",{className:"card-header"},l.createElement("h2",null,l.createElement(r.OKX,null)," Recent Activity")),l.createElement("div",{className:"history-list"},w.length>0?w.map((e,t)=>l.createElement(E,{key:t,item:{action:e.action,time:new Date(e.created_at).toLocaleString(),icon:l.createElement(r.A7C,null)}})):l.createElement("div",{className:"status-header"},l.createElement("p",{className:"no-activity"},"No recent activity")))),false))),!M&&l.createElement("button",{className:"floating-edit-btn",onClick:()=>f(!0),title:"Edit Profile"},l.createElement(s.SG1,null)),l.createElement("div",{className:"edit-sidebar "+(M?"open":"")},l.createElement("div",{className:"edit-sidebar-header"},l.createElement("h3",null,"Edit Profile"),l.createElement("button",{className:"close-sidebar",onClick:()=>f(!1)},l.createElement(s.yGN,null))),l.createElement("div",{className:"edit-sidebar-content"},[{key:"fullName",label:"Full Name",type:"text"},{key:"phone",label:"Phone Number",type:"text"},{key:"email",label:"Email",type:"email"},{key:"dob",label:"Date of Birth",type:"date"},{key:"address",label:"Address",type:"text"},{key:"hometown",label:"Hometown",type:"text"},{key:"field",label:"Field of Expertise",type:"text"},{key:"goals",label:"Personal Goals",type:"textarea"},{key:"vision",label:"Future Vision",type:"textarea"}].map(e=>l.createElement("div",{className:"profile-field",key:e.key},l.createElement("label",null,e.label),"textarea"===e.type?l.createElement("textarea",{className:"edit-input",rows:3,value:k[e.key],onChange:t=>j(Object.assign({},k,{[e.key]:t.target.value}))}):l.createElement("input",{type:e.type,className:"edit-input",value:k[e.key],onChange:t=>j(Object.assign({},k,{[e.key]:t.target.value}))}))),l.createElement("button",{className:"save-sidebar-btn",onClick:async()=>{b(!0);const e=await o(k);var a;(b(!1),e.success)?(alert("✅ Saved!"),f(!1),t(k),localStorage.setItem("user",JSON.stringify(k))):alert("❌ Failed: "+(null===(a=e.error)||void 0===a?void 0:a.message))}},l.createElement(s.Bc_,{style:{marginRight:"8px"}}),"Save Changes"))))},v=a(856),g=()=>l.createElement(v.A,{redirectTo:"/sign-in"},l.createElement(N,null))},7843:function(e,t,a){a.d(t,{A:function(){return n}});var l=a(6540);var n=e=>{let{url:t,width:a=100,height:n=100,alt:s="User Avatar",className:r=""}=e;const{0:i,1:c}=(0,l.useState)(!1),{0:o,1:m}=(0,l.useState)(!1),d=!t||o||""===t.trim()||!i;return l.createElement("img",{src:d?"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjkwOSIgaGVpZ2h0PSIyOTA5IiB2aWV3Qm94PSIwIDAgMjkwOSAyOTA5IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMjkwOC42IDE0NTQuMjVDMjkwOC42IDIyNTcuNCAyMjU3LjQ4IDI5MDguNSAxNDU0LjMgMjkwOC41QzY1MS4xMiAyOTA4LjUgMCAyMjU3LjQgMCAxNDU0LjI1QzAgNjUxLjA5NyA2NTEuMTIgMCAxNDU0LjMgMEMyMjU3LjQ4IDAgMjkwOC42IDY1MS4wOTcgMjkwOC42IDE0NTQuMjVaIiBmaWxsPSIjRDdFMUUxIi8+CjxwYXRoIGQ9Ik0yMzY3LjkzIDI1MDUuMjRWMjU4NS42OUMyMTE4LjIzIDI3ODcuNTYgMTgwMC4zOSAyOTA4LjQ3IDE0NTQuMjcgMjkwOC40N0MxMTA4LjIyIDI5MDguNDcgNzkwLjMzOSAyNzg3LjU2IDU0MC42NyAyNTg1Ljc2VjI1MDUuMjRDNTQwLjY3IDIwNzAuNTEgODkzLjEwNSAxNzE4LjAyIDEzMjcuODUgMTcxOC4wMkgxNTgwLjcxQzIwMTUuNSAxNzE4LjAyIDIzNjcuOTMgMjA3MC41MSAyMzY3LjkzIDI1MDUuMjRaIiBmaWxsPSIjQTFBRUIwIi8+CjxwYXRoIGQ9Ik0xOTM3LjM2IDEwMjIuMjZDMTkzNy4zNiAxMjg5LjA0IDE3MjEuMDkgMTUwNS4zIDE0NTQuMyAxNTA1LjNDMTE4Ny41MSAxNTA1LjMgOTcxLjI0MSAxMjg5LjA0IDk3MS4yNDEgMTAyMi4yNkM5NzEuMjQxIDc1NS40NzMgMTE4Ny41MSA1MzkuMjEzIDE0NTQuMyA1MzkuMjEzQzE3MjEuMDkgNTM5LjIxMyAxOTM3LjM2IDc1NS40NzMgMTkzNy4zNiAxMDIyLjI2WiIgZmlsbD0iI0ExQUVCMCIvPgo8L3N2Zz4K":t,alt:s,width:a,height:n,className:"rounded-full object-cover "+r+" "+(d?"fallback-avatar":""),onLoad:()=>c(!0),onError:()=>m(!0),loading:"lazy"})}}}]);
//# sourceMappingURL=component---src-pages-members-dashboard-index-tsx-caf92bfb2bc5e2a01b44.js.map